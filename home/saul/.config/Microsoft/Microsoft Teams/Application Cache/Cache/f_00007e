function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj;};}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof(obj);}!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports;}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i});},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0});},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==_typeof(t)&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t){n.d(i,r,function(e){return t[e];}.bind(null,r));}return i;},n.n=function(t){var e=t&&t.__esModule?function(){return t.default;}:function(){return t;};return n.d(e,"a",e),e;},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e);},n.p="https://statics.teams.cdn.office.net/teams-modular-packages/hashed-assets/",n(n.s=0);}([function(t,e,n){"use strict";n.r(e);var i={};n.r(i),n.d(i,"DedicatedWorkerRouter",function(){return ht;}),n.d(i,"initialize",function(){return _t;});var _r=function r(t,e){return(_r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e;}||function(t,e){for(var n in e){e.hasOwnProperty(n)&&(t[n]=e[n]);}})(t,e);};var s,o,a=function(){function t(){this.messageHandlers={};}return t.prototype.registerMessageHandler=function(t,e){if(this.messageHandlers[t])throw new Error("message handler already registered for - "+t);this.messageHandlers[t]=e;},t.prototype.unregisterMessageHandler=function(t){delete this.messageHandlers[t];},t;}();!function(t){t[t.BT_STOP=0]="BT_STOP",t[t.BT_STOP_BASE=1]="BT_STOP_BASE",t[t.BT_BOOL=2]="BT_BOOL",t[t.BT_UINT8=3]="BT_UINT8",t[t.BT_UINT16=4]="BT_UINT16",t[t.BT_UINT32=5]="BT_UINT32",t[t.BT_UINT64=6]="BT_UINT64",t[t.BT_FLOAT=7]="BT_FLOAT",t[t.BT_DOUBLE=8]="BT_DOUBLE",t[t.BT_STRING=9]="BT_STRING",t[t.BT_STRUCT=10]="BT_STRUCT",t[t.BT_LIST=11]="BT_LIST",t[t.BT_SET=12]="BT_SET",t[t.BT_MAP=13]="BT_MAP",t[t.BT_INT8=14]="BT_INT8",t[t.BT_INT16=15]="BT_INT16",t[t.BT_INT32=16]="BT_INT32",t[t.BT_INT64=17]="BT_INT64",t[t.BT_WSTRING=18]="BT_WSTRING",t[t.BT_UNAVAILABLE=127]="BT_UNAVAILABLE";}(s||(s={})),function(t){t[t.MARSHALED_PROTOCOL=0]="MARSHALED_PROTOCOL",t[t.MAFIA_PROTOCOL=17997]="MAFIA_PROTOCOL",t[t.COMPACT_PROTOCOL=16963]="COMPACT_PROTOCOL",t[t.JSON_PROTOCOL=21322]="JSON_PROTOCOL",t[t.PRETTY_JSON_PROTOCOL=20554]="PRETTY_JSON_PROTOCOL",t[t.SIMPLE_PROTOCOL=20563]="SIMPLE_PROTOCOL";}(o||(o={}));var u,h,_,c=function(){function t(){}return t.GetBytes=function(t){for(var e=[],n=0;n<t.length;++n){var i=t.charCodeAt(n);i<128?e.push(i):i<2048?e.push(192|i>>6,128|63&i):i<55296||i>=57344?e.push(224|i>>12,128|i>>6&63,128|63&i):(i=65536+((1023&i)<<10|1023&t.charCodeAt(++n)),e.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i));}return e;},t;}(),l=function(){function t(){}return t.GetString=function(t){var e,n,i,r,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=[],a=t.length%3;for(e=0,i=t.length-a;e<i;e+=3){n=(t[e]<<16)+(t[e+1]<<8)+t[e+2],o.push([s.charAt((r=n)>>18&63),s.charAt(r>>12&63),s.charAt(r>>6&63),s.charAt(63&r)].join(""));}switch(a){case 1:n=t[t.length-1],o.push(s.charAt(n>>2)),o.push(s.charAt(n<<4&63)),o.push("==");break;case 2:n=(t[t.length-2]<<8)+t[t.length-1],o.push(s.charAt(n>>10)),o.push(s.charAt(n>>4&63)),o.push(s.charAt(n<<2&63)),o.push("=");}return o.join("");},t;}(),f=function(){function t(){}return t.GetBytes=function(t){for(var e=[];4294967168&t;){e.push(127&t|128),t>>>=7;}return e.push(127&t),e;},t;}(),p=function(){function t(){}return t.GetBytes=function(t){for(var e=t.low,n=t.high,i=[];n||4294967168&e;){i.push(127&e|128),e=(127&n)<<25|e>>>7,n>>>=7;}return i.push(127&e),i;},t;}(),d=function(){function t(){}return t.GetBytes=function(t){if(m.IsDataViewSupport()){var e=new DataView(new ArrayBuffer(4));e.setFloat32(0,t,!0);for(var n=[],i=0;i<4;++i){n.push(e.getUint8(i));}return n;}return S.ConvertNumberToArray(t,!1);},t;}(),g=function(){function t(){}return t.GetBytes=function(t){if(m.IsDataViewSupport()){var e=new DataView(new ArrayBuffer(8));e.setFloat64(0,t,!0);for(var n=[],i=0;i<8;++i){n.push(e.getUint8(i));}return n;}return S.ConvertNumberToArray(t,!0);},t;}(),I=function(){function t(){}return t.EncodeZigzag16=function(t){return(t=y.ToInt16(t))<<1^t>>15;},t.EncodeZigzag32=function(t){return(t=y.ToInt32(t))<<1^t>>31;},t.EncodeZigzag64=function(t){var e=t.low,n=t.high,i=n<<1|e>>>31,r=e<<1;2147483648&n&&(i=~i,r=~r);var s=new E("0");return s.low=r,s.high=i,s;},t;}(),S=(function(){function t(){}t.GetString=function(t){for(var e=[],n=0;n<t.length;++n){var i=t[n];if(i<=191)e.push(String.fromCharCode(i));else if(i<=223){var r=t[++n];e.push(String.fromCharCode((31&i)<<6|63&r));}else if(i<=239){r=t[++n];var s=t[++n];e.push(String.fromCharCode((15&i)<<12|(63&r)<<6|63&s));}else{i=(7&i)<<18|(63&(r=t[++n]))<<12|(63&(s=t[++n]))<<6|63&t[++n],i-=65536,e.push(String.fromCharCode(55296|i>>10&1023)),e.push(String.fromCharCode(56320|1023&i));}}return e.join("");};}(),function(){function t(){}t.GetBytes=function(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=[],i=0;i<t.length;++i){var r=e.indexOf(t.charAt(i++)),s=e.indexOf(t.charAt(i++)),o=e.indexOf(t.charAt(i++)),a=e.indexOf(t.charAt(i));n.push(r<<2|s>>4),o>=0&&(n.push(s<<4&240|o>>2),a>=0&&n.push(o<<6&192|a));}return n;};}(),function(){function t(){}t.GetInt64=function(t){var e=new T("0"),n=this._Read(t);return e.low=n[0],n.length>1&&(e.high=n[1]),e;},t.GetNumber=function(t){return this._Read(t)[0];},t._Read=function(t){for(var e=[],n=0,i=!0,r=0;i;){if(i=0!=(128&(s=t.shift())),s&=127,!(r<28)){n|=s<<r,e.push(n),n=s>>4,r=3;break;}n|=s<<r,r+=7;}for(;i;){var s;if(i=0!=(128&(s=t.shift())),n|=(s&=127)<<r,(r+=7)>=32)break;}return e.push(n),e;};}(),function(){function t(){}t.GetNumber=function(t){if(m.IsDataViewSupport()){for(var e=new DataView(new ArrayBuffer(4)),n=0;n<4;++n){e.setUint8(n,t[n]);}return e.getFloat32(0,!0);}return S.ConvertArrayToNumber(t,!1);};}(),function(){function t(){}t.GetNumber=function(t){if(m.IsDataViewSupport()){for(var e=new DataView(new ArrayBuffer(8)),n=0;n<8;++n){e.setUint8(n,t[n]);}return e.getFloat64(0,!0);}return S.ConvertArrayToNumber(t,!0);};}(),function(){function t(){}t.DecodeZigzag16=function(t){return((65535&t)>>>1^-(1&t))<<16>>16;},t.DecodeZigzag32=function(t){return t>>>1^-(1&t);},t.DecodeZigzag64=function(t){var e=1&t.high,n=t.high>>>1,i=1&t.low,r=t.low>>>1;r|=e<<31,i&&(r^=4294967295,n^=4294967295);var s=new E("0");return s.low=r,s.high=n,s;};}(),function(){function t(){}return t.ConvertNumberToArray=function(t,e){if(!t)return e?this._doubleZero:this._floatZero;var n=e?52:23,i=(1<<(e?11:8)-1)-1,r=1-i,s=i,o=t<0?1:0;t=Math.abs(t);for(var a=Math.floor(t),u=t-a,h=2*(i+2)+n,_=new Array(h),c=0;c<h;){_[c++]=0;}for(c=i+2;c&&a;){_[--c]=a%2,a=Math.floor(a/2);}for(c=i+1;c<h-1&&u>0;){(u*=2)>=1?(_[++c]=1,--u):_[++c]=0;}for(var l=0;l<h&&!_[l];++l){;}var f=i+1-l,p=l+n;if(_[p+1]){for(c=p;c>l&&!(_[c]=1-_[c]);--c){;}c==l&&++f;}if(f>s||a)return o?e?this._doubleNegInifinity:this._floatNegInifinity:e?this._doubleInifinity:this._floatInifinity;if(f<r)return e?this._doubleZero:this._floatZero;if(e){var d=0;for(c=0;c<20;++c){d=d<<1|_[++l];}for(var g=0;c<52;++c){g=g<<1|_[++l];}return[255&g,g>>8&255,g>>16&255,g>>>24,255&(d=o<<31|2147483647&(d|=f+i<<20)),d>>8&255,d>>16&255,d>>>24];}var I=0;for(c=0;c<23;++c){I=I<<1|_[++l];}return[255&(I=o<<31|2147483647&(I|=f+i<<23)),I>>8&255,I>>16&255,I>>>24];},t.ConvertArrayToNumber=function(t,e){var n=(1<<(e?11:8)-1)-1,i=0!=(128&t[e?7:3]),r=e?(127&t[7])<<4|(240&t[6])>>4:(127&t[3])<<1|(128&t[2])>>7;if(255==r)throw new R("Not a valid float/double buffer.");var s=1,o=1;if(e){var a=(15&t[6])<<28|(255&t[5])<<20|(255&t[4])<<12,u=t[3]<<24|(255&t[2])<<16|(255&t[1])<<8|255&t[0];if(!r&&!a&&!u)return 0;for(var h=0;h<20;++h){o/=2,a<0&&(s+=o),a<<=1;}for(h=0;h<32;++h){o/=2,u<0&&(s+=o),u<<=1;}}else{var _=(127&t[2])<<25|(255&t[1])<<17|(255&t[0])<<9;if(!r&&!_)return 0;for(h=0;h<23;++h){o/=2,_<0&&(s+=o),_<<=1;}}return s*=Math.pow(2,r-n),i?0-s:s;},t._floatZero=[0,0,0,0],t._doubleZero=[0,0,0,0,0,0,0,0],t._floatInifinity=[0,0,128,127],t._floatNegInifinity=[0,0,128,255],t._doubleInifinity=[0,0,0,0,0,0,240,127],t._doubleNegInifinity=[0,0,0,0,0,0,240,255],t;}()),T=function(){function t(t){this.low=0,this.high=0,this.low=parseInt(t),this.low<0&&(this.high=-1);}return t.prototype.Equals=function(e){var n=new t(e);return this.low==n.low&&this.high==n.high;},t;}(),E=function(){function t(t){this.low=0,this.high=0,this.low=parseInt(t);}return t.prototype.Equals=function(e){var n=new t(e);return this.low==n.low&&this.high==n.high;},t;}(),y=function(){function t(){}return t.ToByte=function(t){return this.ToUInt8(t);},t.ToInt8=function(t){return 127&t|(128&t)<<24>>24;},t.ToInt16=function(t){return 32767&t|(32768&t)<<16>>16;},t.ToInt32=function(t){return 2147483647&t|2147483648&t;},t.ToUInt8=function(t){return 255&t;},t.ToUInt16=function(t){return 65535&t;},t.ToUInt32=function(t){return 4294967295&t;},t;}(),R=function R(t){this.Message=t;},m=function(){function t(){}return t.IsDataViewSupport=function(){return"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView;},t;}(),A=function(){function t(t){this._stream=t;}return t.prototype.WriteBlob=function(t){this._stream.Write(t,0,t.length);},t.prototype.WriteBool=function(t){this._stream.WriteByte(t?1:0);},t.prototype.WriteContainerBegin=function(t,e){this.WriteUInt8(e),this.WriteUInt32(t);},t.prototype.WriteMapContainerBegin=function(t,e,n){this.WriteUInt8(e),this.WriteUInt8(n),this.WriteUInt32(t);},t.prototype.WriteContainerEnd=function(){},t.prototype.WriteDouble=function(t){var e=g.GetBytes(t);this._stream.Write(e,0,e.length);},t.prototype.WriteFloat=function(t){var e=d.GetBytes(t);this._stream.Write(e,0,e.length);},t.prototype.WriteFieldBegin=function(t,e,n){e<=5?this._stream.WriteByte(t|e<<5):e<=255?(this._stream.WriteByte(192|t),this._stream.WriteByte(e)):(this._stream.WriteByte(224|t),this._stream.WriteByte(e),this._stream.WriteByte(e>>8));},t.prototype.WriteFieldEnd=function(){},t.prototype.WriteFieldOmitted=function(t,e,n){},t.prototype.WriteInt16=function(t){t=I.EncodeZigzag16(t),this.WriteUInt16(t);},t.prototype.WriteInt32=function(t){t=I.EncodeZigzag32(t),this.WriteUInt32(t);},t.prototype.WriteInt64=function(t){this.WriteUInt64(I.EncodeZigzag64(t));},t.prototype.WriteInt8=function(t){this._stream.WriteByte(y.ToInt8(t));},t.prototype.WriteString=function(t){if(""==t)this.WriteUInt32(0);else{var e=c.GetBytes(t);this.WriteUInt32(e.length),this._stream.Write(e,0,e.length);}},t.prototype.WriteStructBegin=function(t,e){},t.prototype.WriteStructEnd=function(t){this.WriteUInt8(t?s.BT_STOP_BASE:s.BT_STOP);},t.prototype.WriteUInt16=function(t){var e=f.GetBytes(y.ToUInt16(t));this._stream.Write(e,0,e.length);},t.prototype.WriteUInt32=function(t){var e=f.GetBytes(y.ToUInt32(t));this._stream.Write(e,0,e.length);},t.prototype.WriteUInt64=function(t){var e=p.GetBytes(t);this._stream.Write(e,0,e.length);},t.prototype.WriteUInt8=function(t){this._stream.WriteByte(y.ToUInt8(t));},t.prototype.WriteWString=function(t){this.WriteUInt32(t.length);for(var e=0;e<t.length;++e){var n=t.charCodeAt(e);this._stream.WriteByte(n),this._stream.WriteByte(n>>>8);}},t;}(),v=(function(){function t(){this._buffer=[];}t.prototype.Add=function(t){for(var e=0;e<this._buffer.length&&this._buffer[e]!=t;++e){;}e==this._buffer.length&&this._buffer.push(t);},t.prototype.Count=function(){return this._buffer.length;},t.prototype.GetBuffer=function(){return this._buffer;};}(),function(){function t(){this._buffer=[];}return t.prototype.Add=function(t,e){-1==this._getIndex(t)&&this._buffer.push({Key:t,Value:e});},t.prototype.AddOrReplace=function(t,e){var n=this._getIndex(t);n>=0?this._buffer[n]={Key:t,Value:e}:this._buffer.push({Key:t,Value:e});},t.prototype.Remove=function(t){var e=this._getIndex(t);e>=0&&this._buffer.splice(e,1);},t.prototype.Count=function(){return this._buffer.length;},t.prototype.GetBuffer=function(){return this._buffer;},t.prototype.ContainsKey=function(t){return this._getIndex(t)>=0;},t.prototype.Get=function(t){var e=this._getIndex(t);return e>=0?this._buffer[e].Value:null;},t.prototype._getIndex=function(t){for(var e=0,n=-1;e<this._buffer.length;++e){if(this._buffer[e].Key==t){n=e;break;}}return n;},t;}()),N=function(){function t(){}return t.GetGuid=function(){var t=function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1,5);};return[t(),t(),"-",t(),"-",t(),"-",t(),"-",t(),t(),t()].join("");},t.GetTimeStamp=function(){var t=new Date().getTime(),e=new T("0");return e.low=4294967295&t,e.high=Math.floor(t/4294967296),e;},t.GetTimeStampWithValue=function(t){var e=new T("0");return e.low=4294967295&t,e.high=Math.floor(t/4294967296),e;},t;}();!function(t){t[t.NotSet=0]="NotSet",t[t.Event=1]="Event",t[t.PerformanceCounter=2]="PerformanceCounter",t[t.Anomaly=3]="Anomaly",t[t.Prediction=4]="Prediction",t[t.TraceLog=5]="TraceLog",t[t.EventSourceLog=6]="EventSourceLog",t[t.HttpLog=7]="HttpLog",t[t.PerformanceCounterAzure=8]="PerformanceCounterAzure",t[t.PerformanceCounterGfs=9]="PerformanceCounterGfs";}(u||(u={})),function(t){t[t.NotSet=0]="NotSet",t[t.O365=1]="O365",t[t.SkypeBI=2]="SkypeBI",t[t.SkypeData=3]="SkypeData";}(h||(h={})),function(t){t[t.NotSet=0]="NotSet",t[t.DistinguishedName=1]="DistinguishedName",t[t.GenericData=2]="GenericData",t[t.IPV4Address=3]="IPV4Address",t[t.IPv6Address=4]="IPv6Address",t[t.MailSubject=5]="MailSubject",t[t.PhoneNumber=6]="PhoneNumber",t[t.QueryString=7]="QueryString",t[t.SipAddress=8]="SipAddress",t[t.SmtpAddress=9]="SmtpAddress",t[t.Identity=10]="Identity",t[t.Uri=11]="Uri",t[t.Fqdn=12]="Fqdn",t[t.IPV4AddressLegacy=13]="IPV4AddressLegacy",t[t.FilePath=14]="FilePath";}(_||(_={}));var O,C=function(){function t(){this.ScrubType=h.NotSet,this.Kind=_.NotSet,this.RawContent="";}return t.prototype.Write=function(t){this.WriteImpl(t,!1);},t.prototype.WriteImpl=function(t,e){t.WriteStructBegin(null,e),this.ScrubType!=h.NotSet?(t.WriteFieldBegin(s.BT_INT32,1,null),t.WriteInt32(this.ScrubType),t.WriteFieldEnd()):t.WriteFieldOmitted(s.BT_INT32,1,null),this.Kind!=_.NotSet?(t.WriteFieldBegin(s.BT_INT32,2,null),t.WriteInt32(this.Kind),t.WriteFieldEnd()):t.WriteFieldOmitted(s.BT_INT32,2,null),""!=this.RawContent?(t.WriteFieldBegin(s.BT_STRING,3,null),t.WriteString(this.RawContent),t.WriteFieldEnd()):t.WriteFieldOmitted(s.BT_STRING,3,null),t.WriteStructEnd(e);},t.prototype.Read=function(t){this.ReadImpl(t,!1);},t.prototype.ReadImpl=function(t,e){},t;}(),D=function(){function t(){this.Id=N.GetGuid(),this.Timestamp=N.GetTimeStamp(),this.Type="",this.EventType="",this.Extension=new v(),this.RecordType=u.NotSet,this.PIIExtensions=new v();}return t.prototype.AddOrReplacePII=function(t,e,n){var i=new C();i.RawContent=e,i.Kind=n,i.ScrubType=h.O365,this.PIIExtensions.AddOrReplace(t,i);},t.prototype.Write=function(t){this.WriteImpl(t,!1);},t.prototype.WriteImpl=function(t,e){if(t.WriteStructBegin(null,e),""!=this.Id?(t.WriteFieldBegin(s.BT_STRING,1,null),t.WriteString(this.Id),t.WriteFieldEnd()):t.WriteFieldOmitted(s.BT_STRING,1,null),this.Timestamp.Equals("0")?t.WriteFieldOmitted(s.BT_INT64,3,null):(t.WriteFieldBegin(s.BT_INT64,3,null),t.WriteInt64(this.Timestamp),t.WriteFieldEnd()),""!=this.Type?(t.WriteFieldBegin(s.BT_STRING,5,null),t.WriteString(this.Type),t.WriteFieldEnd()):t.WriteFieldOmitted(s.BT_STRING,5,null),""!=this.EventType?(t.WriteFieldBegin(s.BT_STRING,6,null),t.WriteString(this.EventType),t.WriteFieldEnd()):t.WriteFieldOmitted(s.BT_STRING,6,null),this.Extension.Count()){t.WriteFieldBegin(s.BT_MAP,13,null),t.WriteMapContainerBegin(this.Extension.Count(),s.BT_STRING,s.BT_STRING);for(var n=0;n<this.Extension.GetBuffer().length;++n){t.WriteString(this.Extension.GetBuffer()[n].Key),t.WriteString(this.Extension.GetBuffer()[n].Value);}t.WriteContainerEnd(),t.WriteFieldEnd();}else t.WriteFieldOmitted(s.BT_MAP,13,null);if(this.RecordType!=u.NotSet?(t.WriteFieldBegin(s.BT_INT32,24,null),t.WriteInt32(this.RecordType),t.WriteFieldEnd()):t.WriteFieldOmitted(s.BT_INT32,24,null),this.PIIExtensions.Count()){t.WriteFieldBegin(s.BT_MAP,30,null),t.WriteMapContainerBegin(this.PIIExtensions.Count(),s.BT_STRING,s.BT_STRUCT);for(var i=0;i<this.PIIExtensions.GetBuffer().length;++i){t.WriteString(this.PIIExtensions.GetBuffer()[i].Key),this.PIIExtensions.GetBuffer()[i].Value.WriteImpl(t,!1);}t.WriteContainerEnd(),t.WriteFieldEnd();}else t.WriteFieldOmitted(s.BT_MAP,30,null);t.WriteStructEnd(e);},t.prototype.Read=function(t){this.ReadImpl(t,!1);},t.prototype.ReadImpl=function(t,e){},t;}(),W=function(){function t(){this.Source="",this.DataPackageId="",this.Timestamp=new T("0"),this.Records=[];}return t.prototype.Write=function(t){this.WriteImpl(t,!1);},t.prototype.WriteImpl=function(t,e){if(t.WriteStructBegin(null,e),""!=this.Source?(t.WriteFieldBegin(s.BT_STRING,2,null),t.WriteString(this.Source),t.WriteFieldEnd()):t.WriteFieldOmitted(s.BT_STRING,2,null),""!=this.DataPackageId?(t.WriteFieldBegin(s.BT_STRING,5,null),t.WriteString(this.DataPackageId),t.WriteFieldEnd()):t.WriteFieldOmitted(s.BT_STRING,5,null),this.Timestamp.Equals("0")?t.WriteFieldOmitted(s.BT_INT64,6,null):(t.WriteFieldBegin(s.BT_INT64,6,null),t.WriteInt64(this.Timestamp),t.WriteFieldEnd()),this.Records.length){t.WriteFieldBegin(s.BT_LIST,8,null),t.WriteContainerBegin(this.Records.length,s.BT_STRUCT);for(var n=0;n<this.Records.length;++n){this.Records[n].WriteImpl(t,!1);}t.WriteContainerEnd(),t.WriteFieldEnd();}else t.WriteFieldOmitted(s.BT_LIST,8,null);t.WriteStructEnd(e);},t.prototype.Read=function(t){this.ReadImpl(t,!1);},t.prototype.ReadImpl=function(t,e){},t;}(),V=function(){function t(){this.DataPackages=[],this.RequestRetryCount=0;}return t.prototype.Write=function(t){this.WriteImpl(t,!1);},t.prototype.WriteImpl=function(t,e){if(t.WriteStructBegin(null,e),this.DataPackages.length){t.WriteFieldBegin(s.BT_LIST,1,null),t.WriteContainerBegin(this.DataPackages.length,s.BT_STRUCT);for(var n=0;n<this.DataPackages.length;++n){this.DataPackages[n].WriteImpl(t,!1);}t.WriteContainerEnd(),t.WriteFieldEnd();}else t.WriteFieldOmitted(s.BT_LIST,1,null);0!=this.RequestRetryCount?(t.WriteFieldBegin(s.BT_INT32,2,null),t.WriteInt32(this.RequestRetryCount),t.WriteFieldEnd()):t.WriteFieldOmitted(s.BT_INT32,2,null),t.WriteStructEnd(e);},t.prototype.Read=function(t){this.ReadImpl(t,!1);},t.prototype.ReadImpl=function(t,e){},t;}(),w=function(){function t(){}return t.IsSafariOrFirefox=function(){return null===t._isSafariOrFirefox&&t._DetectBrowser(),t._isSafariOrFirefox;},t.ajax=function(e){var n=t._createConnection();if(e.headers){var i="qsp=true";for(var r in e.headers){i+="&",i+=encodeURIComponent(r),i+="=",i+=encodeURIComponent(e.headers[r]);}e.url.indexOf("?")<0?e.url+="?":e.url+="&",e.url+=i;}n.open(e.type,e.url),e.complete&&(n.onload=function(){void 0===n.status&&(n.status=200),e.complete(n);},n.ontimeout=function(){void 0===n.status&&(n.status=500),e.complete(n);},n.onerror=function(){e.complete(n);}),n.send(e.data);},t.keys=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var n in t){t.hasOwnProperty(n)&&e.push(n);}return e;},t.IsUsingXDomainRequest=function(){null==t._usingXDomainRequest&&(void 0===new XMLHttpRequest().withCredentials&&"undefined"!=typeof XDomainRequest?t._usingXDomainRequest=!0:t._usingXDomainRequest=!1);return t._usingXDomainRequest;},t._createConnection=function(){var e=new XMLHttpRequest();return t.IsUsingXDomainRequest()?new XDomainRequest():e;},t._DetectBrowser=function(){var e=navigator.userAgent.toLowerCase();(e.indexOf("safari")>=0||e.indexOf("firefox")>=0)&&e.indexOf("chrome")<0?t._isSafariOrFirefox=!0:t._isSafariOrFirefox=!1;},t._isSafariOrFirefox=null,t._usingXDomainRequest=null,t;}(),b=function(){function t(){this._buffer=[];}return t.prototype.WriteByte=function(t){this._buffer.push(y.ToByte(t));},t.prototype.Write=function(t,e,n){for(;n--;){this.WriteByte(t[e++]);}},t.prototype.GetBuffer=function(){return this._buffer;},t;}(),P=function(){function t(){this.data=[];}return t.prototype.WriteBlob=function(t){var e={type:"blob",value:t};this.data.push(e);},t.prototype.WriteBool=function(t){var e={type:"boolean",value:t};this.data.push(e);},t.prototype.WriteContainerBegin=function(t,e){var n={type:"containerBegin",size:t,elementType:e};this.data.push(n);},t.prototype.WriteMapContainerBegin=function(t,e,n){var i={type:"mapContainerBegin",size:t,keyType:e,valueType:n};this.data.push(i);},t.prototype.WriteContainerEnd=function(){this.data.push({type:"containerEnd"});},t.prototype.WriteDouble=function(t){var e={type:"number",value:t};this.data.push(e);},t.prototype.WriteFloat=function(t){var e={type:"number",value:t};this.data.push(e);},t.prototype.WriteFieldBegin=function(t,e,n){var i={type:"fieldBegin",id:e};this.data.push(i);},t.prototype.WriteFieldEnd=function(){this.data.push({type:"fieldEnd"});},t.prototype.WriteFieldOmitted=function(t,e,n){var i={type:"fieldOmitted",id:e};this.data.push(i);},t.prototype.WriteInt16=function(t){var e={type:"number",value:t};this.data.push(e);},t.prototype.WriteInt32=function(t){var e={type:"number",value:t};this.data.push(e);},t.prototype.WriteInt64=function(t){var e={type:"number",value:4294967296*t.high+t.low};this.data.push(e);},t.prototype.WriteInt8=function(t){var e={type:"number",value:t};this.data.push(e);},t.prototype.WriteString=function(t){var e={type:"string",value:t};this.data.push(e);},t.prototype.WriteStructBegin=function(t,e){var n={type:"structBegin",isBase:e};this.data.push(n);},t.prototype.WriteStructEnd=function(t){var e={type:"structEnd",isBase:t};this.data.push(e);},t.prototype.WriteUInt16=function(t){var e={type:"number",value:t};this.data.push(e);},t.prototype.WriteUInt32=function(t){var e={type:"number",value:t};this.data.push(e);},t.prototype.WriteUInt64=function(t){var e={type:"number",value:t};this.data.push(e);},t.prototype.WriteUInt8=function(t){var e={type:"number",value:t};this.data.push(e);},t.prototype.WriteWString=function(t){var e={type:"string",value:t};this.data.push(e);},t;}();!function(t){t[t.ECS_ERROR_OK=0]="ECS_ERROR_OK",t[t.ECS_ERROR_INVALID_STATUS=1]="ECS_ERROR_INVALID_STATUS",t[t.ECS_ERROR_INVALID_RESPONSE=6]="ECS_ERROR_INVALID_RESPONSE",t[t.ECS_ERROR_INVALID_CONFIG=8]="ECS_ERROR_INVALID_CONFIG";}(O||(O={}));var L,B=function(){function t(t){this._errorCode=t;}return t.prototype.ErrorCode=function(){return this._errorCode;},t.prototype.toString=function(){switch(this._errorCode){case O.ECS_ERROR_OK:return"ECS_ERROR_OK";case O.ECS_ERROR_INVALID_STATUS:return"ECS_ERROR_INVALID_STATUS";case O.ECS_ERROR_INVALID_RESPONSE:return"ECS_ERROR_INVALID_RESPONSE";case O.ECS_ERROR_INVALID_CONFIG:return"ECS_ERROR_INVALID_CONFIG";default:return"Unknown error";}},t;}();!function(t){t[t.CONFIG_UPDATED=0]="CONFIG_UPDATED",t[t.TOKEN_IS_INVALID=1]="TOKEN_IS_INVALID";}(L||(L={}));var M,x=function(){function t(){}return t.prototype.Copy=function(t){if(this.uiVersion=t.uiVersion,this.log=t.log,this.servers=void 0,t.servers&&t.servers.length){this.servers=[];for(var e=0;e<t.servers.length;++e){this.servers.push(t.servers[e]);}}},t;}(),k=(function(){function t(){}t.CreateEcsClient=function(){return new F();},t.__ChangeFailedRetryFactorInMS=function(t){k.FailedRetryFactorInMS=t;};}(),function(){function t(){}return t.Servers=["https://config.teams.microsoft.com/config/v1/Skype/"],t.RefreshIntervalInMS=36e5,t.FailedRetryFactorInMS=1e4,t.MaxRetryIntervalForFailedInMS=36e5,t;}());!function(t){t[t.Created=0]="Created",t[t.Initialized=1]="Initialized",t[t.Started=2]="Started",t[t.Loading=3]="Loading";}(M||(M={}));var G,U,F=function(){function t(){this._tag=0,this._status=M.Created,this._listeners=[],this._failedTimes={},this._skypeToken=null,this._pendingToken=[],this._queryParams={};}return t.prototype.Initialize=function(t){if(this._status!=M.Created)throw new B(O.ECS_ERROR_INVALID_STATUS);if(!t||!t.uiVersion)throw new B(O.ECS_ERROR_INVALID_CONFIG);this._config=new x(),this._config.Copy(t),this._config.uiVersion=this._config.uiVersion.replace("/","_");var e=[];if(this._config.servers&&this._config.servers.length)e=this._config.servers;else for(var n=0;n<k.Servers.length;++n){e.push(k.Servers[n]);}for(var i=[];e.length;){var r=Math.floor(Math.random()*e.length);i.push(e[r]),r==e.length-1?e.pop():e[r]=e.pop();}this._config.servers=i,this._Info("servers: "+this._config.servers.join(",")),this._status=M.Initialized,this._Verbose("Initialize() done");},t.prototype.AddListener=function(t){this._Verbose("AddListener()"),this._CheckStatus(M.Initialized);for(var e=0;e<this._listeners.length;++e){if(this._listeners[e]==t)return void this._Verbose("the listener has been added already, index: "+e);}this._listeners.push(t);},t.prototype.RemoveListener=function(t){this._Verbose("RemoveListener()"),this._CheckStatus(M.Initialized);for(var e=0;e<this._listeners.length;++e){if(this._listeners[e]==t)return void(e==this._listeners.length-1?this._listeners.pop():this._listeners[e]=this._listeners.pop());}},t.prototype.Start=function(){this._Verbose("Start()"),this._CheckStatus(M.Initialized),this._status>=M.Started?this._Verbose("Start() already, ignore"):(++this._tag,this._status=M.Started,this.ConfigReloadAsync());},t.prototype.Stop=function(){this._Verbose("Stop()"),this._CheckStatus(M.Initialized),this._status!=M.Initialized?(this._CleanTimer(),this._ecsConfig=null,this._etag=null,this._expireTime=null,this._failedTimes={},this._status=M.Initialized):this._Verbose("Stop() already, ignore");},t.prototype.GetETag=function(){return this._CheckStatus(M.Started),this._etag;},t.prototype.SetSkypeToken=function(t){this._Verbose("SetToken()"),this._CheckStatus(M.Started),t=t||null,this._status==M.Loading?(this._Verbose("A request is ongoing, postpone."),this._pendingToken.push(t)):(this._skypeToken=t,this.ConfigReloadAsync());},t.prototype.ConfigReloadAsync=function(){var t=this;if(this._Verbose("ConfigReloadAsync()"),this._CheckStatus(M.Started),this._status!=M.Loading){this._CleanTimer();var e=this._tag,n=this._config.servers[0]+this._config.uiVersion,i={};for(var r in this._queryParams){for(var s in i[r]={},this._queryParams[r]){i[r][s]=this._queryParams[r][s];}}i.Headers={},!w.IsUsingXDomainRequest()&&this._etag&&(i.Headers["If-None-Match"]=this._etag),this._skypeToken&&(i.Headers.SkypeToken=this._skypeToken),0==w.keys(i.Headers).length&&delete i.Headers,w.ajax({type:"POST",url:n,data:JSON.stringify(i),complete:function complete(n){return t._HttpCallback(e,n);}}),this._status=M.Loading;}else this._Verbose("ConfigReloadAsync() is loading, ignore");},t.prototype.AddQueryParameter=function(t,e,n){if(e&&n){t||(t="global");var i=t.toLowerCase();if("headers"==i)return;i in this._queryParams||(this._queryParams[i]={}),this._queryParams[i][e.toLowerCase()]=n.toLowerCase();}},t.prototype.RemoveQueryParameter=function(t,e){var n="global";t&&(n=t.toLowerCase()),e&&(e=e.toLowerCase(),n in this._queryParams&&e in this._queryParams[n]&&(delete this._queryParams[n][e],0==w.keys(this._queryParams[n]).length&&delete this._queryParams[n]));},t.prototype.RemoveQueryParameterByNamespace=function(t){t=t?t.toLowerCase():"global",delete this._queryParams[t];},t.prototype.GetSetting=function(t,e,n){return this._CheckStatus(M.Started),t?this._GetSettingAsDefault(t,e,n,JSON.stringify):this._ecsConfig?JSON.stringify(this._ecsConfig):"";},t.prototype.GetSettingAsString=function(t,e,n){return this._CheckStatus(M.Started),this._GetSettingAsDefault(t,e,n,function(t){return""+t;});},t.prototype.GetSettingAsInt=function(t,e,n){return this._CheckStatus(M.Started),this._GetSettingAsDefault(t,e,n,parseInt);},t.prototype.GetSettingAsBool=function(t,e,n){return this._CheckStatus(M.Started),this._GetSettingAsDefault(t,e,n,function(t){return!!t;});},t.prototype.GetSettingAsReal=function(t,e,n){return this._CheckStatus(M.Started),this._GetSettingAsDefault(t,e,n,parseFloat);},t.prototype.GetSettingAsList=function(t,e){return this._CheckStatus(M.Started),this._GetSettingAsList(t,e,function(t){return""+t;});},t.prototype.GetSettingAsListOfInts=function(t,e){return this._CheckStatus(M.Started),this._GetSettingAsList(t,e,parseInt);},t.prototype.GetSettingAsListOfReal=function(t,e){return this._CheckStatus(M.Started),this._GetSettingAsList(t,e,parseFloat);},t.prototype.GetKeys=function(t,e){if(this._CheckStatus(M.Started),!t)return this.GetAgents();var n=this._NormalizePath(t,e);return n?this._GetObjectKeys(this._GetObject(n)):[];},t.prototype.GetAgents=function(){return this._CheckStatus(M.Started),this._GetObjectKeys(this._ecsConfig);},t.prototype._HttpCallback=function(t,e){if(this._Verbose("_HttpCallback"),this._status==M.Loading&&t==this._tag){var n=!0,i=!1;try{if(null==e)throw this._Error("jqXHR is null. exception"),new B(O.ECS_ERROR_INVALID_RESPONSE);var r=this._ParseResponse(e),s=r.statuscode;if(this._Info("status of HttpCallback: "+s),s>=200&&s<=299){var o=r.etag;if(this._Verbose("etag: "+o),!o)throw new B(O.ECS_ERROR_INVALID_RESPONSE);r.expires;this._Verbose("2xx: JSON.parse() success."),this._etag=o,this._ecsConfig=r.data,this._expireTime=r.expires,this._Notify(L.CONFIG_UPDATED);}else switch(s){case 304:this._Verbose("Config is not changed. Update expire time only."),this._expireTime=r.expires;break;case 401:this._Warning("token is invalid"),n=!1,this._Notify(L.TOKEN_IS_INVALID);break;case-1:n=!1;break;default:throw new B(O.ECS_ERROR_INVALID_RESPONSE);}}catch(t){this._Error("exception: "+t),i=!0;}n&&this._ScheduleTimer(i),this._status=M.Started;}else this._Verbose("_status != loading || tag != _tag, ignore");},t.prototype._Notify=function(t){for(var e=0;e<this._listeners.length;++e){this._listeners[e](t);}},t.prototype._ScheduleTimer=function(t){var e=this;if(this._CleanTimer(),t){var n=this._config.servers.shift();this._failedTimes[n]?++this._failedTimes[n]:this._failedTimes[n]=1,this._config.servers.push(n);var i=this._failedTimes[this._config.servers[0]]||0,r=0;i&&(r=Math.pow(2,i-1)*k.FailedRetryFactorInMS)>k.MaxRetryIntervalForFailedInMS&&(r=k.MaxRetryIntervalForFailedInMS),this._timer=setTimeout(function(){return e.ConfigReloadAsync();},r);}else{this._failedTimes[this._config.servers[0]]=0;var s=!1;if(this._pendingToken.length){this._Verbose("Pending token found.");var o=this._pendingToken.pop();this._pendingToken.splice(0,this._pendingToken.length),o!=this._skypeToken&&(this._Verbose("Trigger new request immediately."),this._skypeToken=o,s=!0);}r=0;s||(r=k.RefreshIntervalInMS,this._expireTime&&(r=this._expireTime-new Date().getTime())<0&&(r=0)),this._timer=setTimeout(function(){return e.ConfigReloadAsync();},r);}},t.prototype._CleanTimer=function(){this._timer&&(clearTimeout(this._timer),this._timer=null);},t.prototype._GetSettingAsDefault=function(t,e,n,i){if(!t)return n;var r=this._NormalizePath(t,e);if(!r)return n;var s=this._GetObject(r);if(null==s)return n;try{return i(s);}catch(t){return n;}},t.prototype._GetSettingAsList=function(t,e,n){if(!t)return[];var i=this._NormalizePath(t,e);if(!i)return[];var r=this._GetObject(i);if(null==r)return[];try{for(var s=[],o=0;o<r.length;++o){s.push(n(r[o]));}return s;}catch(t){return[];}},t.prototype._CheckStatus=function(t){if(this._status<t)throw this._Error(["status is error, current status:",this._status,"minimalStatus:",t].join(" ")),new B(O.ECS_ERROR_INVALID_STATUS);},t.prototype._GetObjectKeys=function(t){var e=[];if(null!=t)for(var n in t){e.push(n);}return e;},t.prototype._GetObject=function(t){for(var e=t.split("/"),n=this._ecsConfig,i=0;i<e.length&&n;++i){n=n[e[i]];}return n;},t.prototype._NormalizePath=function(t,e){return null!=e&&e.length&&"/"==e[0]&&(e=e.substr(1)),null!=e&&e.length&&"/"==e[e.length-1]&&(e=e.substr(0,e.length-1)),e?t?t+"/"+e:e:t;},t.prototype._Verbose=function(t){this._config&&this._config.log&&this._config.log.Verbose("[EcsClient]: "+t);},t.prototype._Info=function(t){this._config&&this._config.log&&this._config.log.Info("[EcsClient]: "+t);},t.prototype._Warning=function(t){this._config&&this._config.log&&this._config.log.Warning("[EcsClient]: "+t);},t.prototype._Error=function(t){this._config&&this._config.log&&this._config.log.Error("[EcsClient]: "+t);},t.prototype._ParseResponse=function(t){var e={};if(t&&void 0!==t.status){if(304==t.status){var n=t.getResponseHeader("Expires");this._Verbose("expires: "+n),e.expires=n?Date.parse(n):null,e.etag=t.getResponseHeader("ETag"),e.statuscode=t.status;}else if(t.status>=500)e.statuscode=t.status;else if(0==t.status)this._Verbose("Blocked by same-origin policy."),e.statuscode=-1;else try{e.statuscode=t.status;var i=JSON.parse(t.responseText),r=this._GetHeader(i);if(r){this._Verbose("Header found in body.");n=r.expires;e.expires=n?Date.parse(n):null,e.statuscode=parseInt(r.statuscode),e.etag=r.etag;}else this._Error("Header missing in response body.");e.data=i;}catch(t){this._Error("Failed when parsing");}}else this._Verbose("IE8/IE9 general error handler."),e.statuscode=-1;return this._Verbose("Return code = "+e.statuscode),e;},t.prototype._GetHeader=function(t){var e=null;for(var n in t){if("headers"==n.toLowerCase()){for(var i in e={},t[n]){e[i.toLowerCase()]=t[n][i];}break;}}return e;},t.prototype.__GetListenerArray=function(){return this._listeners;},t.prototype.__UpdateServers=function(t){this._config.servers=t;},t.prototype.__GetQueryParameters=function(){return this._queryParams;},t;}(),z=function(){function t(){}return Object.defineProperty(t,"version",{get:function get(){return"2.5.0";},enumerable:!0,configurable:!0}),t;}();!function(t){t[t.SENT=0]="SENT",t[t.SEND_FAILED=1]="SEND_FAILED";}(G||(G={})),function(t){t[t.DATARV_ERROR_OK=0]="DATARV_ERROR_OK",t[t.DATARV_ERROR_INVALID_EVENT=1]="DATARV_ERROR_INVALID_EVENT",t[t.DATARV_ERROR_INVALID_CONFIG=2]="DATARV_ERROR_INVALID_CONFIG",t[t.DATARV_ERROR_INVALID_DEPENDENCIES=3]="DATARV_ERROR_INVALID_DEPENDENCIES",t[t.DATARV_ERROR_INVALID_STATUS=4]="DATARV_ERROR_INVALID_STATUS",t[t.DATARV_ERROR_INVALID_ARG=5]="DATARV_ERROR_INVALID_ARG";}(U||(U={}));var H,K=function(){function t(t){this._errorCode=U.DATARV_ERROR_OK,this._errorCode=t;}return t.prototype.ErrorCode=function(){return this._errorCode;},t.prototype.toString=function(){switch(this._errorCode){case U.DATARV_ERROR_OK:return"DATARV_ERROR_OK";case U.DATARV_ERROR_INVALID_EVENT:return"Event is invalid. Either event.Id is empty, or event.Timestamp is empty, or event.EventType is empty.";case U.DATARV_ERROR_INVALID_CONFIG:return"Invalid configuration. CollectorUrl is missing.";case U.DATARV_ERROR_INVALID_DEPENDENCIES:return"DATARV_ERROR_INVALID_DEPENDENCIES";case U.DATARV_ERROR_INVALID_STATUS:return"Telemetry Manager is not initialized.";case U.DATARV_ERROR_INVALID_ARG:return"TenantToken is null or empty, or events is null.";default:return"Unknown error";}},t;}(),q=function q(){},j=function(){function t(){}return t.CreateTelemetryManager=function(){return new Z();},t;}(),X=function(){function t(){}return t.MaxPackageSizeInBytes=3e6,t.TimeIntervalForNextSendInMS=15e3,t;}();!function(t){t[t.Created=0]="Created",t[t.Initialized=1]="Initialized",t[t.Started=2]="Started";}(H||(H={}));var Z=function(){function t(){this._MaxPackageSizeInBytes=X.MaxPackageSizeInBytes,this._listeners=[],this._status=H.Created,this._ecsClient=null,this._etag=null,this._ecsCallback=null,this._testServerResponseHook=null,this._testHookListeners=[];}return t.prototype.Initialize=function(t){if(this._status!=H.Created)throw new K(U.DATARV_ERROR_INVALID_STATUS);if(!t||!t.collectorUrl)throw new K(U.DATARV_ERROR_INVALID_CONFIG);this._config=t,this._Reset(),this._status=H.Initialized,t.ecsClient&&(this._Verbose("ECS object assigned. Do integration"),this._ecsClient=t.ecsClient),t.overwriteSendTimeInterval&&t.overwriteSendTimeInterval>=0&&(X.TimeIntervalForNextSendInMS=t.overwriteSendTimeInterval),this._Verbose("Initialize() done");},t.prototype.AddListener=function(t){if(this._status<H.Initialized)throw new K(U.DATARV_ERROR_INVALID_STATUS);this._Verbose(["AddListener(), status: ",this._status," old length: ",this._listeners.length," func: ",t].join(""));for(var e=0;e<this._listeners.length;++e){if(this._listeners[e]==t)return void this._Verbose("the listener has been added already, index: "+e);}this._listeners.push(t),this._Verbose("AddListener() done, the new length: "+this._listeners.length);},t.prototype.RemoveListener=function(t){if(this._status<H.Initialized)throw new K(U.DATARV_ERROR_INVALID_STATUS);this._Verbose(["RemoveListener(), status: ",this._status," old length: ",this._listeners.length," func: ",t].join(""));for(var e=0;e<this._listeners.length;++e){if(this._listeners[e]==t)return 1==this._listeners.length?this._listeners=[]:e==this._listeners.length-1?this._listeners.pop():this._listeners[e]=this._listeners.pop(),void this._Verbose(["this listener has been found, index: ",e,"new length: ",this._listeners.length].join(""));}this._Verbose("listener isn't been found, new length"+this._listeners.length);},t.prototype.Start=function(){if(this._status<H.Initialized)throw new K(U.DATARV_ERROR_INVALID_STATUS);this._Verbose(["Start(), status:",this._status,"tag:",t._tag].join(" ")),this._status>=H.Started&&this._Verbose("Start() already, ignore"),this._ecsClient&&(this._ecsCallback=this._CreateEcsCallback(),this._ecsClient.AddListener(this._ecsCallback),this._etag=this._ecsClient.GetETag()),++t._tag,this._status=H.Started,this._Verbose(["Start() done, status: ",this._status,"tag: ",t._tag].join(""));},t.prototype.Stop=function(){if(this._status<H.Initialized)throw new K(U.DATARV_ERROR_INVALID_STATUS);this._Verbose("Stop(), status: "+this._status),this._status!=H.Initialized?(this._Reset(),this._status=H.Initialized,this._Verbose("Stop() done, status: "+this._status)):this._Verbose("Stop() already, ignore");},t.prototype.Flush=function(t){this._eventsCache.IsEmpty()||this._WorkThread(t);},t.prototype.SendAsync=function(e,n){if(this._status<H.Initialized)throw new K(U.DATARV_ERROR_INVALID_STATUS);if(this._Verbose(["SendAsync(), status:",this._status,"tenantToken:",e,"count:",n.length].join(" ")),this._status<H.Started)return this._Info("SendAsync(), not started, ignore, return false"),!1;if(!e||!n)throw this._Error("SendAsync(), tenantToken or events is null or empty"),new K(U.DATARV_ERROR_INVALID_ARG);for(var i=0;i<n.length;++i){if(!n[i].Id||!t._eventTypeRegex.test(n[i].EventType)||n[i].Timestamp.Equals("0"))throw this._Error(["eventId:",n[i].Id,"eventType:",n[i].EventType,"timestamp high:",n[i].Timestamp.high,"timestamp low:",n[i].Timestamp.low].join("")),new K(U.DATARV_ERROR_INVALID_EVENT);}return this._eventsCache.AddEvents(e,n),this._Verbose(["SendAsync(), currentTimer: ",this._timer,"eventsCacheIsEmpty",this._eventsCache.IsEmpty()].join(" ")),this._eventsCache.IsEmpty()||this._timer||this._ScheduleTimer(!1),this._Verbose("SendAsync() done"),!0;},t.prototype._WorkThread=function(e){var n=this;try{var i=Date.now();if(this._Verbose("_WorkThread, status: "+this._status),this._status<H.Started)return void this._Verbose("_WorkThread, status is not started, return");var r=this._eventsCache.DequeuEvents();if(null==r)return this._Verbose("_WorkThread, No events found, return"),void this._CleanTimer();var s=r.events.length,o=this._PackEvents(r.tenantToken,r.events);this._eventsCache.AddEvents(r.tenantToken,o.remainedEvents);var a=o.remainedEvents.length;if(null==o.buffer||0==o.buffer.length)return void(this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1)));if(this._testHookListeners)for(var u=0;u<this._testHookListeners.length;++u){this._testHookListeners[u](o.sendEvents);}if(this._testServerResponseHook){var h=this._testServerResponseHook();return void setTimeout(function(){return n._SendCallback(c,r.tenantToken,o.sendEvents,h,null);},100);}var _={type:"POST",url:this._config.collectorUrl,processData:!1,headers:{"content-type":"application/bond-compact-binary","client-id":"NO_AUTH","sdk-version":"ACT-Web-JS-"+z.version},complete:function complete(t){return n._SendCallback(c,r.tenantToken,o.sendEvents,t,e);}};this._config.useJsonTextStream?(_.data=o.buffer,_.headers["content-type"]="application/json"):w.IsSafariOrFirefox()||"undefined"==typeof Uint8Array?(this._Verbose("Uint8Array is undefined, send with base64 encode."),_.data=l.GetString(o.buffer),_.headers["content-encoding"]="base64"):(this._Verbose("Uint8Array is defined, send with binary format directly."),_.data=new Uint8Array(o.buffer)),r.tenantToken&&(_.headers["x-apikey"]=r.tenantToken);var c=t._tag;this._lastActiveTime=new Date().getTime(),w.ajax(_),this._Verbose("_Workthread, send via jquery, tag: "+c),this._Info("Processing telemetry events took "+(Date.now()-i)+" ms for "+(s-a)+" events with total size of "+o.buffer.length+" bytes, remaining events - "+a);}catch(t){this._Error("_WorkThread, exception: "+t);}},t.prototype._PackEvents=function(t,e){this._Verbose("_PackageEvents, total Count: "+e.length);var n,i=new V(),r=new W();r.Source="JS_default_source",r.DataPackageId=N.GetGuid(),r.Timestamp=N.GetTimeStamp();var s=e;if(e=[],s.length>200){var o=s.splice(0,200);e.push.apply(e,s),s=o;}for(;r.Records=[],r.Records.push.apply(r.Records,s),i.DataPackages=[],i.DataPackages.push(r),n=this._Serialize(i),this._Verbose(["_PackageEvents, sendEvents.length:",s.length," buffer.length:",n.length," MaxPackageSize:",this._MaxPackageSizeInBytes].join("")),!(n.length<this._MaxPackageSizeInBytes);){if(1==s.length){s=[],n=null;break;}var a=s.splice(0,Math.floor(s.length/2));this._Verbose("_PackageEvents, too large, package again"),e.push.apply(e,s),s=a;}return this._Verbose(["_PakcageEvents done, sendEventsCount:",s.length,"buffer.length:",null==n?0:n.length,"remained events:",e.length].join("")),{buffer:n,sendEvents:s,remainedEvents:e};},t.prototype._Serialize=function(t){if(this._config.useJsonTextStream){var e=new P();return t.Write(e),JSON.stringify(e.data);}var n=new b(),i=new A(n);return t.Write(i),n.GetBuffer();},t.prototype._SendCallback=function(e,n,i,r,s){if(this._Verbose(["_SendCallback","tag:",e,"current tag:",t._tag,"tenantToken:",n,"events count:",i.length,"jqXHR:",r].join("")),null==s){var o=null!=r&&r.status>=200&&r.status<300;if(this._status<H.Started||e<t._tag)this._Verbose("_SendCallback, is not started, or tag is not the same, return");else{if(!(o||r&&400==r.status))return this._Verbose("retry statusCode: "+(r?r.status:0)),this._eventsCache.AddEvents(n,i),void this._ScheduleTimer(!0);for(var a=0;a<this._listeners.length;++a){this._listeners[a](o?G.SENT:G.SEND_FAILED,r?r.status:0,n,i);}this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1));}}else s(r?r.status:0,n,i);},t.prototype._CleanTimer=function(){this._Verbose("_CleanTimer(), timer: "+this._timer),this._timer&&(clearTimeout(this._timer),this._timer=null);},t.prototype._ScheduleTimer=function(t){var e=this;if(this._Verbose("_ScheduleTimer: isRetry: "+t),this._CleanTimer(),t){this._Verbose("_ScheduleTimer, current factor: "+this._rescheduleFactor);n=Math.floor(5*this._rescheduleFactor*(1+Math.random()));this._timer=setTimeout(function(){return e._WorkThread(null);},1e3*n),this._Verbose("_ScheduleTimer, next try (s): "+n),this._rescheduleFactor<<=1,this._rescheduleFactor>64&&(this._rescheduleFactor=1);}else{var n=0,i=new Date().getTime()-this._lastActiveTime;n=i>X.TimeIntervalForNextSendInMS?0:X.TimeIntervalForNextSendInMS-i,this._timer=setTimeout(function(){return e._WorkThread(null);},n),this._Verbose("_ScheduleTimer, next try: "+n),this._rescheduleFactor=1;}},t.prototype._Verbose=function(t){this._config.log&&this._config.log.Verbose("[TelemetryManagerImpl]: "+t);},t.prototype._Info=function(t){this._config.log&&this._config.log.Info("[TelemetryManagerImpl]: "+t);},t.prototype._Error=function(t){this._config.log&&this._config.log.Error("[TelemetryManagerImpl]: "+t);},t.prototype._Reset=function(){this._Verbose("Reset()"),this._CleanTimer(),this._lastActiveTime=0,this._rescheduleFactor=1,this._sendingEvents=[],this._eventsCache=new Y(),this._ecsClient&&(this._ecsClient.RemoveListener(this._ecsCallback),this._ecsCallback=null);},t.prototype._CreateEcsCallback=function(){var t=this;return function(e){e==L.CONFIG_UPDATED&&(t._etag=t._ecsClient.GetETag());};},t.prototype.__AddTestHookListener=function(t){if(this._status<H.Initialized)throw new K(U.DATARV_ERROR_INVALID_STATUS);for(var e=0;e<this._testHookListeners.length;++e){if(this._testHookListeners[e]==t)return;}this._testHookListeners.push(t);},t.prototype.__ClearTestHookListener=function(){this._testHookListeners=[];},t.prototype.__GetListenerArray=function(){return this._listeners;},t.prototype.__GetTotalEventsCount=function(){return this._eventsCache.GetTotalEventsCount();},t.prototype.__IsScheduled=function(){return null!=this._timer;},t.prototype.__ChageMaxPackageSizeInKB=function(t){this._MaxPackageSizeInBytes=1024*t;},t.prototype.__SetTestServerResponseHook=function(t){this._testServerResponseHook=t;},t._eventTypeRegex=/^[a-zA-Z0-9]([a-zA-Z0-9]|_){2,98}[a-zA-Z0-9]$/,t._tag=0,t;}(),Y=function(){function t(){this._events={},this._tokens=[];}return t.prototype.AddEvents=function(t,e){e.length&&(e.length>1e4||(this._events[t]||(this._events[t]=[],this._tokens.push(t)),this._events[t].push.apply(this._events[t],e)));},t.prototype.IsEmpty=function(){return 0==this._tokens.length;},t.prototype.DequeuEvents=function(){if(0==this._tokens.length)return null;var t=this._tokens.shift(),e=this._events[t];return delete this._events[t],{tenantToken:t,events:e};},t.prototype.GetTotalEventsCount=function(){var t=0;for(var e in this._events){t+=this._events[e].length;}return t;},t;}(),J=null;var Q,$=function(){function t(){this.key=null,this.value=null,this.pii=null;}return t._isPii=function(t){if(t==_.NotSet)return!1;var e=!1;for(var n in _){isNaN(n)||n==t&&(e=!0);}return e;},t;}(),tt=function(){function t(){this.name=null,this.timestamp=null,this.properties=[],this.eventType=null;}return t.prototype.setProperty=function(e,n,i){if(!e||!this.properties[e]&&!t._propertyNameRegex.test(e))throw new nt(Q.INVALID_PROPERTY_NAME);this.properties[e]={key:e,value:n,pii:i!=_.NotSet?i:null};},t.prototype.unsetProperty=function(t){if(!t)throw new nt(Q.INVALID_PROPERTY_NAME);void 0!==this.properties[t]&&(this.properties[t]=void 0,delete this.properties[t]);},t._propertyNameRegex=/^[a-zA-Z0-9](([a-zA-Z0-9|_|.]){0,98}[a-zA-Z0-9])?$/,t;}();!function(t){t[t.INVALID_TENANT_TOKEN=1]="INVALID_TENANT_TOKEN",t[t.MISSING_EVENT_PROPERTIES_NAME=2]="MISSING_EVENT_PROPERTIES_NAME",t[t.INVALID_PROPERTY_NAME=3]="INVALID_PROPERTY_NAME",t[t.INVALID_COLLECTOR_URL=4]="INVALID_COLLECTOR_URL",t[t.MISSING_FAILURE_SIGNATURE=5]="MISSING_FAILURE_SIGNATURE",t[t.MISSING_FAILURE_DETAIL=6]="MISSING_FAILURE_DETAIL",t[t.MISSING_PAGEVIEW_ID=7]="MISSING_PAGEVIEW_ID",t[t.MISSING_PAGEVIEW_NAME=8]="MISSING_PAGEVIEW_NAME",t[t.INVALID_SESSION_STATE=9]="INVALID_SESSION_STATE";}(Q||(Q={}));var et,nt=function(){function t(t){this.errorCode=null,this.errorCode=t;}return t.prototype.ErrorCode=function(){return this.errorCode;},t.prototype.toString=function(){switch(this.errorCode){case Q.INVALID_TENANT_TOKEN:return"Invalid tenant token";case Q.MISSING_EVENT_PROPERTIES_NAME:return"Eventproperties.name can not be null or empty";case Q.INVALID_PROPERTY_NAME:return"Invalid Key. Key does not conform to regular expression ^[a-zA-Z0-9](([a-zA-Z0-9|_]){0,98}[a-zA-Z0-9])?$";case Q.INVALID_COLLECTOR_URL:return"Collector url can't be null or empty.";case Q.MISSING_FAILURE_SIGNATURE:return"Failure signature can't be null or empty.";case Q.MISSING_FAILURE_DETAIL:return"Failure detail can't be null or empty.";case Q.MISSING_PAGEVIEW_ID:return"Pageview id can't be null or empty.";case Q.MISSING_PAGEVIEW_NAME:return"Pageview name can't be null or empty.";case Q.INVALID_SESSION_STATE:return"Session state has to be a value from the SessionState enum.";default:return"Unknown error";}},t;}(),it=function(){function t(t){this.contextMap=new v(),this.piiKind=_.NotSet,this._allowDeviceInfoFields=!1,this._allowDeviceInfoFields=t;}return t.prototype.setAppId=function(t){t&&this.contextMap.Add("AppInfo.Id",t);},t.prototype.setAppVersion=function(t){t&&this.contextMap.Add("AppInfo.Version",t);},t.prototype.setAppClientType=function(t){t&&this.contextMap.Add("AppInfo.ClientType",t);},t.prototype.setAppLanguage=function(t){t&&this.contextMap.Add("AppInfo.Language",t);},t.prototype.setDeviceId=function(t){t&&this._allowDeviceInfoFields&&this.contextMap.Add("DeviceInfo.Id",t);},t.prototype.setDeviceOsName=function(t){t&&this._allowDeviceInfoFields&&this.contextMap.Add("DeviceInfo.OsName",t);},t.prototype.setDeviceOsVersion=function(t){t&&this._allowDeviceInfoFields&&this.contextMap.Add("DeviceInfo.OsVersion",t);},t.prototype.setDeviceBrowserName=function(t){t&&this._allowDeviceInfoFields&&this.contextMap.Add("DeviceInfo.BrowserName",t);},t.prototype.setDeviceBrowserVersion=function(t){t&&this._allowDeviceInfoFields&&this.contextMap.Add("DeviceInfo.BrowserVersion",t);},t.prototype.setUserId=function(t,e){t&&this.contextMap.Add("UserInfo.Id",t),$._isPii(e)&&(this.piiKind=e);},t.prototype.setUserMsaId=function(t){t&&this.contextMap.Add("UserInfo.MsaId",t);},t.prototype.setUserANID=function(t){t&&this.contextMap.Add("UserInfo.ANID",t);},t.prototype.setUserAdvertisingId=function(t){t&&this.contextMap.Add("UserInfo.AdvertisingId",t);},t.prototype.setUserTimeZone=function(t){t&&this.contextMap.Add("UserInfo.TimeZone",t);},t.prototype.setUserLanguage=function(t){t&&this.contextMap.Add("UserInfo.Language",t);},t.prototype.setUserRing=function(t){t&&this.contextMap.Add("UserInfo.Ring",t);},t.prototype.setUserTenantId=function(t){t&&this.contextMap.Add("UserInfo.TenantId",t);},t;}(),rt=function(){function t(){}return t.initialize=function(e){t.documentInfo=e;var n=e.appLanguage;n&&t.semanticContext.setAppLanguage(n);var i=e.userLanguage;i&&t.semanticContext.setUserLanguage(i);var r=new Date().getTimezoneOffset(),s=r%60,o=(r-s)/60,a="+";o>0&&(a="-"),s=Math.abs(s);var u=a+((o=Math.abs(o))<10?"0"+o:o.toString())+":"+(s<10?"0"+s:s.toString());t.semanticContext.setUserTimeZone(u),t.semanticContext.setDeviceBrowserName(t._getBrowserName()),t.semanticContext.setDeviceBrowserVersion(t._getBrowserVersion()),t.semanticContext.setDeviceOsName(t._getOsName()),t.semanticContext.setDeviceOsVersion(t._getOsVersion()),t.semanticContext.setDeviceId(e.deviceId),t.firstLaunchTime=e.firstLaunchTime,t.semanticContext.setAppVersion(e.appVersion);},t._getUserAgent=function(){return t.documentInfo.userAgent;},t._userAgentContainsString=function(e){return t._getUserAgent().indexOf(e)>-1;},t._isIe=function(){return t._userAgentContainsString("Trident");},t._isEdge=function(){return t._userAgentContainsString(t.BROWSERS.EDGE);},t._isEdgeAnaheim=function(){return t._userAgentContainsString("Edg/");},t._isOpera=function(){return t._userAgentContainsString("OPR/");},t._getBrowserName=function(){return t._isOpera()?t.BROWSERS.UNKNOWN:t._userAgentContainsString(t.BROWSERS.PHANTOMJS)?t.BROWSERS.PHANTOMJS:t._isEdge()?t.BROWSERS.EDGE:t._isEdgeAnaheim()?t.BROWSERS.EDGEANAHEIM:t._userAgentContainsString(t.BROWSERS.ELECTRON)?t.BROWSERS.ELECTRON:t._userAgentContainsString(t.BROWSERS.CHROME)?t.BROWSERS.CHROME:t._userAgentContainsString(t.BROWSERS.FIREFOX)?t.BROWSERS.FIREFOX:t._userAgentContainsString(t.BROWSERS.SAFARI)?t.BROWSERS.SAFARI:t._userAgentContainsString(t.BROWSERS.SKYPE_SHELL)?t.BROWSERS.SKYPE_SHELL:t._isIe()?t.BROWSERS.MSIE:t.BROWSERS.UNKNOWN;},t._getBrowserVersion=function(){return t._isIe()?function(){var e,n=t._getUserAgent(),i=n.match(new RegExp(t.BROWSERS.MSIE+" "+t.REGEX_VERSION));if(i)return i[1];if(e=n.match(new RegExp("rv:"+t.REGEX_VERSION)))return e[1];}():function(e){var n;e===t.BROWSERS.SAFARI?e="Version":e===t.BROWSERS.EDGEANAHEIM&&(e="Edg");if(n=t._getUserAgent().match(new RegExp(e+"/"+t.REGEX_VERSION)))return n[1];return t.UNKNOWN_VERSION;}(t._getBrowserName());},t._getOsName=function(){return t._getUserAgent().match(/windows\sphone\s\d+\.\d+/i)?t.OPERATING_SYSTEMS.WINDOWS_PHONE:t._getUserAgent().match(/ arm;/i)?t.OPERATING_SYSTEMS.WINDOWS_RT:t._getUserAgent().match(/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i)?t.OPERATING_SYSTEMS.IOS:t._getUserAgent().match(/android/i)?t.OPERATING_SYSTEMS.ANDROID:t._getUserAgent().match(/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i)?t.OPERATING_SYSTEMS.LINUX:t._getUserAgent().match(/(macintosh|mac os x)/i)?t.OPERATING_SYSTEMS.MACOSX:t._getUserAgent().match(/(windows|win32)/i)?t.OPERATING_SYSTEMS.WINDOWS:t.OPERATING_SYSTEMS.UNKNOWN;},t._getOsVersion=function(){return t._getOsName()===t.OPERATING_SYSTEMS.WINDOWS?function(){var e=t._getUserAgent().match(new RegExp("Windows NT "+t.REGEX_VERSION));if(e&&t.VERSION_MAPPINGS[e[1]])return t.VERSION_MAPPINGS[e[1]];return t.UNKNOWN_VERSION;}():t._getOsName()===t.OPERATING_SYSTEMS.MACOSX?function(){var e=t._getUserAgent().match(new RegExp(t.OPERATING_SYSTEMS.MACOSX+" "+t.REGEX_VERSION_MAC));if(e){var n=e[1].replace(/_/g,".");if(n){var i=function(t){if(t.indexOf(".")>-1)return".";if(t.indexOf("_")>-1)return"_";return null;}(n);return i?n.split(i)[0]:n;}}return t.UNKNOWN_VERSION;}():t.UNKNOWN_VERSION;},t.semanticContext=new it(!0),t.firstLaunchTime=-1,t.BROWSERS={MSIE:"MSIE",CHROME:"Chrome",FIREFOX:"Firefox",SAFARI:"Safari",EDGE:"Edge",EDGEANAHEIM:"EdgeAnaheim",ELECTRON:"Electron",SKYPE_SHELL:"SkypeShell",PHANTOMJS:"PhantomJS",UNKNOWN:"Unknown"},t.OPERATING_SYSTEMS={WINDOWS:"Windows",MACOSX:"Mac OS X",WINDOWS_PHONE:"Windows Phone",WINDOWS_RT:"Windows RT",IOS:"iOS",ANDROID:"Android",LINUX:"Linux",UNKNOWN:"Unknown"},t.VERSION_MAPPINGS={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"},t.REGEX_VERSION="([\\d,.]+)",t.REGEX_VERSION_MAC="([\\d,_,.]+)",t.UNKNOWN_VERSION="Unknown",t.DEVICE_ID_COOKIE="MicrosoftApplicationsTelemetryDeviceId",t.FIRST_LAUNCH_TIME_COOKIE="MicrosoftApplicationsTelemetryFirstLaunchTime",t;}();!function(t){t[t.STARTED=0]="STARTED",t[t.ENDED=1]="ENDED";}(et||(et={}));var st=function(){function t(){}return t.initialize=function(e,n){if(!t._initialized){if(!n)throw new nt(Q.INVALID_TENANT_TOKEN);t._defaultToken=n,t._config.collectorUrl||(t._config.collectorUrl="https://browser.pipe.aria.microsoft.com/Collector/3.0/"),J||(J=j.CreateTelemetryManager()).Initialize(t._config),J.Start(),rt.initialize(e),t._initialized=!0;}},t.initializeWithConfiguration=function(e,n,i){if(!i.collectorUrl)throw new nt(Q.INVALID_COLLECTOR_URL);t._config.collectorUrl=i.collectorUrl,t.initialize(e,n);},t.flush=function(t){J.Flush(t);},t.addCallbackListener=function(e){t._initialized&&J.AddListener(e);},t.setContext=function(e,n,i){""!==n&&"null"!==n&&"undefined"!==n?t._contextProperties.setProperty(e,n,i):t._contextProperties.unsetProperty(e);},t.isInitialized=function(){return t._initialized;},t.getDefaultToken=function(){return t._defaultToken;},t.getSemanticContext=function(){return t._semanticContext;},t.__addTestHookListener=function(e){t._initialized&&J.__AddTestHookListener(e);},t.__clearTestHookListener=function(){t._initialized&&J.__ClearTestHookListener();},t.__backToUninitialized=function(){t._config=new q(),t._semanticContext=new it(!0),t._contextProperties=new tt(),J=j.CreateTelemetryManager(),t._initialized=!1;},t._initialized=!1,t._defaultToken=null,t._config=new q(),t._contextProperties=new tt(),t._semanticContext=new it(!0),t;}(),ot=function(){function t(t){this._initId=N.GetGuid(),this._sequence=0,this._tenantToken=null,this._contextProperties=new tt(),this._semanticContext=new it(!1),this._sessionStartTime=0,this._sessionId=null,this._tenantToken=t||st.getDefaultToken();}return t.prototype.logEvent=function(t){if(!t.name)throw new nt(Q.MISSING_EVENT_PROPERTIES_NAME);var e=this._createEventRecord(t.name,t.eventType);this._addCustomPropertiesToEvent(e,t),this._sendRecord(e);},t.prototype.logFailure=function(t,e,n,i,r){if(!t)throw new nt(Q.MISSING_FAILURE_SIGNATURE);if(!e)throw new nt(Q.MISSING_FAILURE_DETAIL);var s=this._createEventRecord("failure","failure");s.Extension.Add("Failure.Signature",t),s.Extension.Add("Failure.Detail",e),n&&s.Extension.Add("Failure.Category",n),i&&s.Extension.Add("Failure.Id",i),this._addCustomPropertiesToEvent(s,r),this._sendRecord(s);},t.prototype.logPageView=function(t,e,n,i,r,s){if(!t)throw new nt(Q.MISSING_PAGEVIEW_ID);if(!e)throw new nt(Q.MISSING_PAGEVIEW_NAME);var o=this._createEventRecord("pageview","pageview");o.Extension.Add("PageView.Id",t),o.Extension.Add("PageView.Name",e),n&&o.Extension.Add("PageView.Category",n),i&&o.Extension.Add("PageView.Uri",i),r&&o.Extension.Add("PageView.ReferrerUri",r),this._addCustomPropertiesToEvent(o,s),this._sendRecord(o);},t.prototype.logSession=function(t,e,n,i){if(t!==et.STARTED&&t!==et.ENDED)throw new nt(Q.INVALID_SESSION_STATE);var r=this._createEventRecord("session","session");if(t===et.STARTED){if(this._sessionStartTime>0)return;this._sessionStartTime=i||new Date().getTime(),this._sessionId=n||N.GetGuid(),r.Extension.Add("Session.Id",this._sessionId),r.Extension.Add("Session.State","Started");}else if(t===et.ENDED){if(0==this._sessionStartTime)return;var s=Math.floor((new Date().getTime()-this._sessionStartTime)/1e3);r.Extension.Add("Session.Duration",s.toString()),r.Extension.Add("Session.DurationBucket",this._getSessionDurationFromTime(s)),r.Extension.Add("Session.Id",this._sessionId),r.Extension.Add("Session.State","Ended"),this._sessionId=null,this._sessionStartTime=0;}r.Extension.Add("Session.FirstLaunchTime",new Date(rt.firstLaunchTime).toISOString()),this._addCustomPropertiesToEvent(r,e),this._sendRecord(r);},t.prototype.getSessionId=function(){return this._sessionId;},t.prototype.setContext=function(t,e,n){this._contextProperties.setProperty(t,e,n);},t.prototype.getSemanticContext=function(){return this._semanticContext;},t.prototype._getSessionDurationFromTime=function(t){return t<0?"Undefined":t<=3?"UpTo3Sec":t<=10?"UpTo10Sec":t<=30?"UpTo30Sec":t<=60?"UpTo60Sec":t<=180?"UpTo3Min":t<=600?"UpTo10Min":t<=1800?"UpTo30Min":"Above30Min";},t.prototype._createEventRecord=function(t,e){var n=new D();e||(e="custom"),n.EventType=t.toLowerCase(),n.Type=e.toLowerCase(),n.Extension.Add("EventInfo.Source","JS_default_source"),n.Extension.Add("EventInfo.InitId",this._initId),this._sequence++,n.Extension.Add("EventInfo.Sequence",this._sequence.toString()),n.Extension.Add("EventInfo.Name",t.toLowerCase());var i=new Date();return n.Timestamp=N.GetTimeStampWithValue(i.getTime()),n.Extension.Add("EventInfo.Time",i.toISOString()),n.Extension.Add("EventInfo.SdkVersion","ACT-Web-JS-"+z.version),n;},t.prototype._addCustomPropertiesToEvent=function(t,e){this._addSemanticContext(t,rt.semanticContext),this._addSemanticContext(t,st._semanticContext),this._addSemanticContext(t,this._semanticContext),this._sessionId&&t.Extension.Add("Session.Id",this._sessionId),this._addEventPropertiesToEvent(t,st._contextProperties),this._addEventPropertiesToEvent(t,this._contextProperties),this._addEventPropertiesToEvent(t,e);},t.prototype._addSemanticContext=function(t,e){if(e&&e.contextMap.Count()>0)for(var n=e.contextMap.GetBuffer(),i=0;i<n.length;i++){"UserInfo.Id"==n[i].Key&&e.piiKind!=_.NotSet?t.AddOrReplacePII(n[i].Key,n[i].Value,e.piiKind):t.Extension.AddOrReplace(n[i].Key,n[i].Value);}},t.prototype._addEventPropertiesToEvent=function(t,e){if(e){e.timestamp&&e.timestamp>=new Date("1/1/2000").getTime()&&(t.Timestamp=N.GetTimeStampWithValue(e.timestamp),t.Extension.AddOrReplace("EventInfo.Time",new Date(e.timestamp).toISOString())),e.name&&(t.EventType=e.name.toLowerCase(),t.Extension.AddOrReplace("EventInfo.Name",e.name.toLowerCase()));var n=e.properties;if(n)for(var i in n){n[i].key&&"string"==typeof n[i].key&&(n[i].value||0==n[i].value||0==n[i].value||""==n[i].value)&&($._isPii(n[i].pii)?(t.AddOrReplacePII(n[i].key,n[i].value.toString(),n[i].pii),t.Extension.Remove(n[i].key)):(t.Extension.AddOrReplace(n[i].key,n[i].value.toString()),t.PIIExtensions.Remove(n[i].key)));}}},t.prototype._sendRecord=function(t){st.isInitialized()&&J.SendAsync(this._tenantToken,[t]);},t;}(),at=function(){function t(){var t;this.telemetry=j.CreateTelemetryManager(),this.ariaLoggers={},t=this.telemetry,J=t;}return t.prototype.initialize=function(t){this.telemetry.Initialize(t.config),st.initialize(t.documentInfo,t.appTokens.default);},t.prototype.start=function(){this.telemetry.Start();},t.prototype.stop=function(){this.telemetry.Stop();},t.prototype.flush=function(t){var e=this,n=8,i=function i(){var r=e.telemetry._eventsCache.IsEmpty(),s=0==--n;r||s?t.postMessage("flushed"):e.telemetry.Flush(i);};i();},t.prototype.createNewLogger=function(t,e){this.ariaLoggers[t]=new ot(e);},t.prototype.logEvent=function(t,e){if(t){var n=this.ariaLoggers[t];n&&n.logEvent(e);}},t.prototype.logSession=function(t,e){var n=this.ariaLoggers[e.name];if(n){var i=e.state;n.logSession(i,e.properties,e.sessionId,e.sessionStartTime),t.postMessage("sessionId",{key:e.name,value:n.getSessionId()});}},t.prototype.setContext=function(t){st.setContext(t.key,t.value,t.pii);},t.prototype.setUserId=function(t){st.getSemanticContext().setUserId(t);},t.prototype.setUserTenantId=function(t){st.getSemanticContext().setUserTenantId(t);},t.prototype.setUserRing=function(t){st.getSemanticContext().setUserRing(t);},t.prototype.setAppClientType=function(t){st.getSemanticContext().setAppClientType(t);},t;}(),ut=function(){function t(){this.telemetryTransport=new at();}return t.prototype.initialize=function(t){if(!t)throw new Error("WebWorkerRouter did not exist.");this.router=t,this._registerMessageHandlers(t);},t.prototype.Verbose=function(t){this.router&&this.router.postMessage("verbose",t);},t.prototype.Error=function(t){this.router&&this.router.postMessage("error",t);},t.prototype.Info=function(t){this.router&&this.router.postMessage("info",t);},t.prototype._registerMessageHandlers=function(t){var e=this;t.registerMessageHandler("initialize",function(t){t.enableDebugTrace?t.config.log=e:t.config.log=void 0,e.telemetryTransport.initialize(t);}),t.registerMessageHandler("start",function(){e.telemetryTransport.start();}),t.registerMessageHandler("stop",function(){e.telemetryTransport.stop();}),t.registerMessageHandler("flush",function(){e.telemetryTransport.flush(t);}),t.registerMessageHandler("newLogger",function(t){e.telemetryTransport.createNewLogger(t.key,t.value);}),t.registerMessageHandler("logEvent",function(t){e.telemetryTransport.logEvent(t.key,t.value);}),t.registerMessageHandler("logSession",function(n){e.telemetryTransport.logSession(t,n);}),t.registerMessageHandler("setUserId",function(t){e.telemetryTransport.setUserId(t);}),t.registerMessageHandler("setUserTenantId",function(t){e.telemetryTransport.setUserTenantId(t);}),t.registerMessageHandler("setUserRing",function(t){e.telemetryTransport.setUserRing(t);}),t.registerMessageHandler("setAppClientType",function(t){e.telemetryTransport.setAppClientType(t);}),t.registerMessageHandler("setContext",function(t){e.telemetryTransport.setContext(t);});},t;}();var ht=function(t){function e(e){var n=t.call(this)||this;return n.worker=e,n.registerMessageHandler("batch",function(t){for(var e=0,i=t;e<i.length;e++){var r=i[e];if(r&&r.name){var s=n.messageHandlers[r.name];s&&s(r.params);}}n.postMessage("batchDone");}),n.worker.onmessage=function(t){return n.onmessageHandler(t);},n.postMessage("workerInitialized"),n;}return function(t,e){function n(){this.constructor=t;}_r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n());}(e,t),e.prototype.postMessage=function(t,e){this.worker.postMessage({name:t,params:e});},e.prototype.registerMessageHandler=function(e,n){t.prototype.registerMessageHandler.call(this,e,n);},e.prototype.unregisterMessageHandler=function(e){t.prototype.unregisterMessageHandler.call(this,e);},e.prototype.onmessageHandler=function(t){if(t&&t.data&&t.data.name){var e=this.messageHandlers[t.data.name];e&&e(t.data.params);}},e;}(a);function _t(t){if(!t.onmessage){var e=new ht(t);new ut().initialize(e);}}_t(self),n.d(e,"TelemetryWebWorker",function(){return ct;});var ct=i;}]);
//# sourceMappingURL=https://local.teams.office.com/sourcemaps/precompiled-telemetry-web-worker-450fa830c2bc4a74daa2.js.map