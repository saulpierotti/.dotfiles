webpackJsonp([39],{2054:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(2055)},2055:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i(2056),a=i(75),r=function(){function e(t,i,s,r,n,o,c,l,h,p,d,u,g,C,m,y,v,f,b,S,R,O,k){var H=this;if(this.$element=t,this.$scope=i,this.$q=s,this.$timeout=r,this.$translate=n,this.routeUtilityService=c,this.conversationsService=l,this.newChatService=h,this.loggingService=p,this.peopleService=d,this.constants=u,this.navigationService=g,this.settingsService=C,this.eventingService=m,this.dialogService=y,this.ariaLiveService=v,this.resources=f,this.filesProviderFactory=R,this.platformDetectService=O,this.isEscDisabled=!0,this.isBotSearchEnabled=!0,this.selectedRecipients=[],this.allSelectedRecipientsMris=[],this.chatHistoryOptionNo="no",this.chatHistoryOptionAll="all",this.chatHistoryOptionCustom="custom",this.isSharingChatHistoryEnabled=!1,this.chatHistoryOption=this.chatHistoryOptionNo,this.chatHistoryNumberOfDays=1,this.hasReachedMaxNumOfRecipients=!1,this.hasBotInGroupChat=!1,this.isInvalidChatHistoryOption=!1,this.disableCompose=!1,this.logger=p.newLogger("chat-people-picker"),this.enableShareChatHistory=!0,!C.valueAsBoolean(u.settings.names.disablePerfTableLogging))var E=p.newCounter(u.counters.newChatInitialMembers);this.enableBlockBotInNewGroupChat=C.valueAsBoolean(u.settings.names.enableBlockBotInNewGroupChat),this.doNotDisableMeetingChats=C.valueAsBoolean(u.settings.names.doNotDisableMeetingChatIfChatsDisabled),this.unknownUserName=n.instant(f.strings.chat_unknownUserDefaultName),this.invalidChatHistoryOptionSelectedError=n.instant(f.strings.chat_invalidChatHistoryOptionSelectedError),this.invalidChatHistoryOptionSelectedErrorResolved=n.instant(f.strings.chat_invalidChatHistoryOptionSelectedErrorResolved),this.enableTargetedChat=k.tagsEnabled()&&C.valueAsBoolean(u.settings.names.enableTargetedChat);var N=c.getRootRouteParams(),w=l.getConversation(N&&N.peopleSlug),I=w&&w.isMeetingConversation(),M=this.getChatRosterLimit(o.chatConstants);if(e.MaxRosterSizeInChat=I?M.meetingRosterLimit:M.groupRosterLimit,this.selectedRecipients=[],this.maxRosterSizeError=I?n.instant(f.strings.chat_privateMeetingErrorTooManyUsersInfo):n.instant(f.strings.chat_updateErrorTooManyUsersInfo,{maxChatSize:e.MaxRosterSizeInChat}),this.existingChatRecipients?1===this.existingChatRecipients.length&&E&&E.mark("populate_from_updatedChat"):(this.existingChatRecipients=[],I||(this.maxRosterSizeError=n.instant(f.strings.chat_creationErrorTooManyUsersInfo,{maxChatSize:e.MaxRosterSizeInChat})),E&&E.mark("populate_from_newChat"),this.populateNewChatRecipients()),this.setShareChatHistoryEnabled(),this.enableShareChatHistory&&(this.chatHistoryCustomInputNarration=n.instant(f.strings.chat_history_return_to_options_instructions)),this.isInvalidChatHistoryOption=this.isInvalidChatHistoryOptionSelected(),E){var D=_.map(this.selectedRecipients,function(e){H.recipientIsConversation(e)?e.id:a.isRecipientTeamTag(e)||e.mri}).join(", ");E.mark("initial_recipients_set",{data:"length: "+(this.selectedRecipients&&this.selectedRecipients.length)+", recipients: "+D})}E&&E.stop(),this.chatFilter=[u.contact.contactType.NonADUser,u.contact.contactType.DistributionList,u.contact.contactType.Channel],h.safeSubscribe(i,function(){H.resetRecipients(),H.setToLineReadOnlyProperty(!1),H.setPlaceholder()},teamspace.services.NewChatServiceEvents.EventType_DeleteNewChat),h.safeSubscribe(i,function(){H.resetRecipients()},teamspace.services.NewChatServiceEvents.EventType_ResetChatPeoplePicker),h.safeSubscribe(i,function(e,t){H.setToLineReadOnlyProperty(!1),t||H.focusElement()},teamspace.services.NewChatServiceEvents.EventType_ResetChatPeoplePickerReadOnlyProperty),h.safeSubscribe(i,function(){return H.focusElement()},teamspace.services.NewChatServiceEvents.EventType_FocusOnToLine),this.setPlaceholder(),h.safeSubscribe(i,function(){H.setPlaceholder(),H.enableBlockBotInNewGroupChat&&H.reevaluateBotSearchEnabled()},teamspace.services.NewChatServiceEvents.EventType_ReevaluateAllowedRecipients),this.focusOnInit&&this.focusElement(),this.registerFocusCallback&&this.registerFocusCallback({callback:function(){H.focusElement()}}),this.p2pListenerRegistration=b.register({onStateChanged:function(e){}},i),this.filesActions=S.create(this.p2pListenerRegistration.getId()),this.setToLineReadOnlyProperty(!1);var P=r(function(){H.updateDialogState()},null,!1);i.$on("$destroy",function(){H.$element=null,r.cancel(P),H.logger.info("calling destroy of chat people picker"),H.focusableElement&&H.focusableElement.off("focus")})}return e.$inject=["$element","$scope","$q","$timeout","$translate","appConfig","routeUtilityService","conversationsService","newChatService","loggingService","peopleService","constants","navigationService","settingsService","eventingService","dialogService","ariaLiveService","resources","p2pFilesStore","filesActionsFactory","filesProviderFactory","platformDetectService","peopleTargetingService"],e.prototype.getChatRosterLimit=function(e){var t=this.settingsService.valueAsBoolean(this.constants.settings.names.increaseChatRosterCapacity),i=this.settingsService.valueFor(this.constants.settings.names.chatRosterCapacityIncreased);return t?{meetingRosterLimit:i||e.maxRosterSizeInPrivateMeetingChat,groupRosterLimit:i||e.maxRosterSizeInGroupChat}:{meetingRosterLimit:e.maxRosterSizeInPrivateMeetingChat,groupRosterLimit:e.maxRosterSizeInGroupChat}},e.prototype.setShareChatHistoryEnabled=function(){if(this.enableShareChatHistory){var e=!1,t=this.routeUtilityService.getRootRouteParams();if(this.id=t&&t.peopleSlug,this.id?this.existingChatRecipients.length>0&&(e=SkypeX.Services.SkypeConversationLocal.isLie(this.id)):this.logger.error("the people slug is invalid"),this.hideShareHistoryOptions)this.isSharingChatHistoryEnabled=!1;else{var i=this.id&&!SkypeX.Services.ChatServiceUtils.isMri(this.id)?this.conversationsService.getConversation(this.id):null;this.isSharingChatHistoryEnabled=!!i&&!e&&!i.isOneOnOne()}this.enableShareChatHistory=this.enableShareChatHistory&&this.isSharingChatHistoryEnabled}},e.prototype.recipientIsConversation=function(e){return e&&e instanceof teamspace.services.ChatConversation},e.prototype.focusElement=function(){var e=this;this.$timeout(function(){e.focusableElement||(e.focusableElement=e.$element.find("input"),e.focusableElement?e.focusableElement.on("focus",function(t){e.onFocusCallback&&e.onFocusCallback()}):e.logger.error('Unable to find "input" element to focus on')),e.focusableElement&&e.focusableElement.length>0&&e.focusableElement.focus()})},e.prototype.populateNewChatRecipients=function(){var e,t=this.newChatService.getNewChat();t&&(t.recipientChats&&t.recipientChats.length>0?this.selectedRecipients=t.recipientChats:this.selectedRecipients=_.uniq((e=teamspace.services.ChatConversationMemberConverter).toUsers.apply(e,t.otherMembers)))},Object.defineProperty(e.prototype,"maxSharedNumberDays",{get:function(){return 999},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minSharedNumberDays",{get:function(){return 1},enumerable:!0,configurable:!0}),e.prototype.chatCustomDaysInputClicked=function(e){this.setChatHistoryFocusAndValue(this.chatHistoryOptionCustom,e),e&&e.stopPropagation()},e.prototype.setChatHistoryValue=function(e){this.chatHistoryOption=e},e.prototype.setChatHistoryFocusAndValue=function(e,t){var i=angular.element("#chat-history-option-"+e),s=angular.element("#chat-history-option-"+this.chatHistoryOption);this.setChatHistoryValue(e),s.get(0).id.contains("chat-history-option")&&(s.attr("tabindex","-1"),s.attr("checked","false"),s.attr("aria-checked","false")),i.attr("tabindex","0"),i.attr("checked","true"),i.attr("aria-checked","true");var a=t&&t.target&&angular.element(t.target);a&&a[0]&&"input"===a[0].tagName.toLowerCase()?(a.is(":disabled")&&a.prop("disabled",!1),a.focus()):i.focus()},e.prototype.validateChatHistoryValue=function(){var e=this.isInvalidChatHistoryOption;this.isInvalidChatHistoryOption=this.isInvalidChatHistoryOptionSelected(),e!==this.isInvalidChatHistoryOption&&this.ariaLiveService.update(this.isInvalidChatHistoryOption?this.invalidChatHistoryOptionSelectedError:this.invalidChatHistoryOptionSelectedErrorResolved,!0)},e.prototype.isAddButtonDisabled=function(){return!this.existingChatRecipients||this.hasReachedMaxNumOfRecipients||0===this.selectedRecipients.length||this.disableCompose||this.isInvalidChatHistoryOptionSelected()},e.prototype.updateDialogState=function(){this.hasReachedMaxNumOfRecipients=this.hasReachedMax(!0),this.hasBotInGroupChat=this.hasBotInNewGroupChat(),this.updateBotSearchEnabled(),this.updateIsChatDisabledStatus(),this.enableBlockBotInNewGroupChat&&this.isBotSelectedAsFirstRecipient()&&this.setToLineReadOnlyProperty(!0)},e.prototype.isBotSelectedAsFirstRecipient=function(){var e=!1;if(this.selectedRecipients&&this.selectedRecipients.length>0){var t=this.selectedRecipients[0];e=!this.recipientIsConversation(t)&&!a.isRecipientTeamTag(t)&&t.type==this.constants.bots.botType}return e},e.prototype.isInvalidChatHistoryOptionSelected=function(){return this.enableShareChatHistory&&this.chatHistoryOption!==this.chatHistoryOptionAll&&this.chatHistoryOption!==this.chatHistoryOptionNo&&!this.isChatHistoryNumberOfDaysValid()},e.prototype.isChatHistoryNumberOfDaysValid=function(){return _.isNumber(this.chatHistoryNumberOfDays)&&this.chatHistoryNumberOfDays>=this.minSharedNumberDays&&this.chatHistoryNumberOfDays<=this.maxSharedNumberDays},e.prototype.updateIsChatDisabledStatus=function(){var e=this;this.didFederatedUserResolutionFail()?(this.notifyChatDisabledMessage=this.getfederatedUserResolutionErrorMessage(this.selectedRecipients[0]),this.disableCompose=!0,this.onDisableComposeCallback&&(this.onDisableComposeCallback({msg:this.notifyChatDisabledMessage,cannotResolveUser:!0}),this.ariaLiveService.update(this.notifyChatDisabledMessage))):this.isChatDisabled()&&(this.disableCompose=!0,this.notifyChatDisabledMessage=null,this.allSelectedRecipientsMris=this.getSelectedRecipientsMris(),this.peopleService.getAllLatestPeopleProfile(this.allSelectedRecipientsMris,"chat-people-picker",!1).then(function(t){e.disableCompose=SkypeX.Services.ChatServiceUtils.isChatDisabledForGroup(t),e.disableCompose&&(e.notifyChatDisabledMessage=e.disableComposeBoxForChatPlaceholder(t),e.ariaLiveService.update(e.notifyChatDisabledMessage)),e.onDisableComposeCallback&&e.onDisableComposeCallback({msg:e.notifyChatDisabledMessage,cannotResolveUser:!1})},function(t){e.logger.error("getAllLatestPeopleProfile - failed getting the data from people service")}))},e.prototype.didFederatedUserResolutionFail=function(){var e=this.selectedRecipients&&1===this.selectedRecipients.length&&!this.recipientIsConversation(this.selectedRecipients[0])&&this.selectedRecipients[0];return!(!e||!e.fetchErrorCode)},e.prototype.isChatDisabled=function(){var e=this.conversationsService.getConversation(this.id),t=e&&e.isFederated(),i=e&&e.isMeetingConversation();return!(t||i&&this.doNotDisableMeetingChats)},e.prototype.getSelectedRecipientsMris=function(){var e=this,t=[];return this.selectedRecipients.forEach(function(i){var s;e.recipientIsConversation(i)?t=t.concat((s=teamspace.services.ChatConversationMemberConverter).toUsers.apply(s,i.otherMembers)):a.isRecipientTeamTag(i)||t.push(i)}),_.map(t,function(e){if(!angular.isUndefined(e.mri))return e.mri})},e.prototype.disableComposeBoxForChatPlaceholder=function(e){var t=SkypeX.Services.ChatServiceUtils.getChatDisabledUsers(e);return null==t?"":1===t.length?this.$translate.instant(this.resources.strings.messages_placeholderMessage_disabled_chat_group_one,{targetOne:t[0]&&t[0].displayName||this.unknownUserName}):2===t.length?this.$translate.instant(this.resources.strings.messages_placeholderMessage_disabled_chat_group_two,{targetOne:t[0]&&t[0].displayName||this.unknownUserName,targetTwo:t[1]&&t[1].displayName||this.unknownUserName}):t.length>2?this.$translate.instant(this.resources.strings.messages_placeholderMessage_disabled_chat_group_3more,{targetOne:t[0]&&t[0].displayName||this.unknownUserName,targetCount:t.length-1}):void 0},e.prototype.getfederatedUserResolutionErrorMessage=function(e){switch(e.fetchErrorCode){case this.constants.errorCodes.notFound:return this.$translate.instant(this.resources.strings.federated_failed_chat_header_user_not_found,{email:e.displayName});case this.constants.errorCodes.forbidden:return this.$translate.instant(this.resources.strings.federated_failed_chat_header_forbidden);default:return this.$translate.instant(this.resources.strings.federated_failed_chat_header_info)}},e.prototype.hasReachedMax=function(t){var i=this;void 0===t&&(t=!1);var s,a=[],r=[];if(this.selectedRecipients){this.selectedRecipients.forEach(function(e){i.recipientIsConversation(e)?(a=a.concat(e.otherMembers),r.push(e)):a.push(e)}),s=(a?a.length:0)+(this.existingChatRecipients?this.existingChatRecipients.length:0)>e.MaxRosterSizeInChat;var n=r&&r.length>0;t&&this.setToLineReadOnlyProperty(n||s)}else s=!1;return s},e.prototype.setToLineReadOnlyProperty=function(e){void 0===e&&(e=!1);var t=this.focusableElement||this.$element.find("input[data-tid='peoplePicker']");return t&&t.length>0&&t[0]&&(t[0].readOnly=e,e&&t.blur()),!1},e.prototype.hasBotInNewGroupChat=function(){var e=this;if(this.existingChatRecipients&&0===this.existingChatRecipients.length&&this.selectedRecipients&&this.selectedRecipients.length>1){var t=_.keys(this.settingsService.valueFor(this.constants.settings.names.botsAllowedForMedia)),i=this.selectedRecipients.some(function(t){return t&&!e.recipientIsConversation(t)&&!a.isRecipientTeamTag(t)&&t.type===e.constants.bots.botType}),s=this.selectedRecipients.some(function(i){return i&&!e.recipientIsConversation(i)&&!a.isRecipientTeamTag(i)&&t.includes(i.mri)});return i&&!s}return!1},e.prototype.addMembersToChat=function(){var e=this,t=!1,i=this.routeUtilityService.getRootRouteParams(),s=i?i.peopleSlug:null,r=SkypeX.Services.ChatServiceUtils.isMri(s),n=s&&this.conversationsService.getCorrespondingConversation(s);if(n||r){var o=r||n&&n.isOneOnOne();o&&this.selectedRecipients.push(this.otherChatRecipient);var c,l=[],h=[],p=[],d={};if(_.forEach(this.selectedRecipients,function(t){var i=!1;if(e.recipientIsConversation(t))i=!0,_.forEach(t.otherMembers,function(t){return c=e.processRecipient(l,h,p,d,t&&{mri:t.mri,upn:t.upn||t.nameHint&&t.nameHint.upn,displayName:t.nameHint&&t.nameHint.displayName}),i=!c});else if(!a.isRecipientTeamTag(t))return c=e.processRecipient(l,h,p,d,t&&{mri:t.mri,upn:t.userPrincipalName,displayName:t.displayName}),i=!c;return i}),!c)if(_.isEmpty(h))c=this.$q.resolve(l);else{if(!t){var u=this.$translate.instant(this.resources.strings.chat_provisioningWaitingForUsers);this.onBegin({message:u}),t=!0}c=this.addMissingMris(h,l,d)}c.then(function(t){try{if(o){if(!(t.length>1))throw e.logger.error("in 1:1 chat expected 1 resolved mri, but received 0 from peopleService"),e.constants.prependedErrorMessages.tooFewUsers+t.length;var i=e.conversationsService.getChatConversationWith(t);e.setToLineReadOnlyProperty(!1),e.navigationService.navigate(e.$scope,e.constants.states.appConversation,{slug:i.id,middlePane:e.constants.messages.panes.conversations,ctx:e.constants.navigation.context.chat,navCtx:"chat-people-picker"})}else{var a=_.difference(t,_.map(e.existingChatRecipients,function(e){return e.mri}));if(e.enableShareChatHistory){var r=e.loggingService.newCounter(e.constants.counters.addRecipientsToGroupChat,{conversationId:s,recipientMris:a.join(", ")}),n=-1;if(e.chatHistoryOption===e.chatHistoryOptionAll)n=0;else if(e.chatHistoryOption===e.chatHistoryOptionNo)n=-1;else{if(e.isInvalidChatHistoryOptionSelected())return r.shareHistoryTime=n,void r.fail({error:"add_recipient_to_group_chat_error",errorInfo:"Invalid Share Chat History option selected"});n=new Date(Date.now()-24*e.chatHistoryNumberOfDays*3600*1e3).getTime()}r.shareHistoryTime=n,e.conversationsService.addUsersToConversation(s,a,n).then(function(){r.mark("add_recipients_to_group_chat_succeeded"),r.stop()},function(t){r.fail({error:"add_recipients_to_group_chat_error",errorInfo:t&&t.message?t.message:""}),e.eventingService.$emit(e.constants.events.messages.messageActionError,{errorMessage:e.$translate.instant(e.resources.strings.chats_addGroupChat_unknownError),conversationId:s})}),e.ariaLiveService.update(e.$translate.instant(e.resources.strings.aria_groupChat_participants_added_mf,{numParticipants:a.length}))}else e.conversationsService.addUsersToConversation(s,a).then(function(){e.ariaLiveService.update(e.$translate.instant(e.resources.strings.aria_groupChat_participants_added_mf,{numParticipants:a.length}))},function(){e.eventingService.$emit(e.constants.events.messages.messageActionError,{errorMessage:e.$translate.instant(e.resources.strings.chats_addGroupChat_unknownError),conversationId:s})})}e.setToLineReadOnlyProperty(!1),e.giveFileSharingPermissions(p,s);var c=e.newChatService.getOpenDialogResult();e.dialogService.close(c&&c.id,!0),e.focusInEditorOnAdd()}catch(t){e.logger.warn(t),t&&""!==t?t.indexOf(e.constants.prependedErrorMessages.tooFewUsers)>=0?t=e.$translate.instant(e.resources.strings.chat_creationErrorTooFewUsers):t.indexOf(e.constants.prependedErrorMessages.oneMoreUser)>=0?t=e.$translate.instant(e.resources.strings.chat_creationErrorNeedOneMoreUserForGroup):t.indexOf(e.constants.prependedErrorMessages.twoMoreUsers)>=0&&(t=e.$translate.instant(e.resources.strings.chat_creationErrorNeedTwoMoreUsersForGroup)):t=e.$translate.instant(e.resources.strings.chat_provisioningDefaultError),e.onError({message:t})}},function(t){e.onError({message:t})})}else{this.logger.warn("Cannot get conversation for conversationId {0}",s),this.setToLineReadOnlyProperty(!1);var g=this.$translate.instant(this.resources.strings.chat_provisioningDefaultError);this.logger.warn(g),this.onError({message:g})}},e.prototype.addMissingMris=function(e,t,i){var s=this;return this.peopleService.getAllPeopleProfile(e,"chat-people-picker").then(function(a){_.isEmpty(a)&&(a=[null]);var r;return _.forEach(a,function(a,n){if(!a||!a.mri){s.logger.warn("User "+n+" in chat creation missing mri");var o=a&&a.displayName;return!o&&i&&(o=i[t[n]]||i[e[n]]),r=s.rejectionMessageForUserName(o),!1}t.push(a.mri)}),r?s.$q.reject(r):t},function(e){var t=s.$translate.instant(s.resources.strings.chat_provisioningDefaultError);return e&&""!==e&&(t=e.message||e),s.$q.reject(t)})},e.prototype.processRecipient=function(e,t,i,s,a){var r;if(a){if(a.mri?e.push(a.mri):t.push(a.upn),!angular.isUndefined(a.upn)&&a.upn.length>0&&i.push(a.upn),s&&a.displayName){var n=a.mri||a.upn;n&&(s[n]=a.displayName)}}else r=this.$q.reject(this.rejectionMessageForUserName(null));return r},e.prototype.rejectionMessageForUserName=function(e){var t=e||this.$translate.instant(this.resources.strings.chat_unknownUserDefaultName);return this.$translate.instant(this.resources.strings.chat_provisioningInvalidUser,{displayName:t})},e.prototype.giveFileSharingPermissions=function(e,t){if(this.enableShareChatHistory&&this.settingsService.valueAsBoolean("chatFilePermissions"))if(e&&e.length&&t)if(this.chatHistoryOption!==this.chatHistoryOptionNo){this.loggingService.newScenario(this.constants.scenarios.files.giveFileSharePermissions,null,null,this.constants.timeInMiliseconds.minute).eventData={source:void 0,destination:void 0,entryPoint:void 0,context:void 0,numberOfSuccesses:0,numberOfCanceled:0,numberOfIncompletes:0,numberOfFailures:0,numberOfFiles:0,numberOfRecipients:0};var i;this.isInvalidChatHistoryOptionSelected()||(i=this.chatHistoryNumberOfDays);var s={recipientEmails:e,chatHistoryNumberOfDays:this.chatHistoryOption===this.chatHistoryOptionAll?this.constants.p2p.chatHistoryIncludeAllDays:i,context:{listenerId:this.p2pListenerRegistration.getId(),threadId:t,serviceName:this.constants.files.serviceName.p2p,provider:this.filesProviderFactory.create(teamspace.services.files.FilesProviderType.Search)}};this.filesActions.shareFiles(s)}else this.logger.info("No files to share - sharing option selected is none");else this.logger.error("Cannot giveFileSharingPermissions, missing param for recipientEmails or conversationId")},e.prototype.tabAndEnterKeyHandler=function(){var e=$(".cke_editable:visible");e&&e.focus()},e.prototype.closeAddMembersDialog=function(){this.dialogService.close(this.constants.dialogs.createChat,!0)},e.prototype.focusInEditorOnAdd=function(){this.eventingService.$emit(this.constants.events.messages.focusInMessageEditorOnAdd,!0)},e.prototype.defaultKeyHandler=function(e){switch(e.keyCode){case this.constants.keyCodes.enter:if(!this.isAddButtonDisabled()&&this.existingChatRecipients&&this.existingChatRecipients.length>0){this.addMembersToChat();break}case this.constants.keyCodes.tab:if(!e.shiftKey&&!e.ctrlKey&&!e.altKey){this.tabAndEnterKeyHandler();break}default:return!1}return!0},e.prototype.updateBotSearchEnabled=function(){this.existingChatRecipients.length>=1||this.enableBlockBotInNewGroupChat&&this.selectedRecipients&&this.selectedRecipients.length>=1?this.isBotSearchEnabled=!1:this.isBotSearchEnabled=!0},e.prototype.reevaluateBotSearchEnabled=function(){this.isBotSearchEnabled=!this.newChatService.showGroupNameLine},e.prototype.setPlaceholder=function(){if(this.rlPpInputTitle===this.$translate.instant(this.resources.strings.chatRecipientGroupUpdate_creationStep1Title))return this.newPlaceholder=this.$translate.instant(this.enableTargetedChat?this.resources.strings.chats_addRecipients_inputPlaceholder_allow_tags:this.resources.strings.chats_addRecipients_inputPlaceholder),void(this.ariaLabelledby=this.newPlaceholder);var e;e=this.enableTargetedChat?this.newChatService.showGroupNameLine?this.resources.strings.chats_addRecipients_inputPlaceholder_allow_tags:this.resources.strings.chats_addRecipients_inputPlaceholder_allow_groups_and_tags:this.newChatService.showGroupNameLine?this.resources.strings.chats_addRecipients_inputPlaceholder:this.resources.strings.chats_addToRecipients_inputPlaceholder_allowGroups,this.newPlaceholder=this.$translate.instant(e),this.ariaLabelledby=this.newPlaceholder},e.prototype.resetRecipients=function(){this.existingChatRecipients=[],this.selectedRecipients=[],this.updateDialogState()},e.prototype.setCustomOptionAriaInfo=function(e){if(e&&e.target){var t=void 0;t=this.isInvalidChatHistoryOption?this.$translate.instant(this.resources.strings.chat_history_include_chat_history_from_x_days_invalid_narration):this.$translate.instant(this.resources.strings.chat_history_include_chat_history_from_x_days_narration_mf,{numberOfDays:this.chatHistoryNumberOfDays},this.constants.translation.interpolationIds.messageformat),e.target.setAttribute("aria-label",t)}},e.prototype.isEdgeBrowser=function(){return this.platformDetectService.getBrowser()==this.constants.browser.edge},e.prototype.keyupHandler=function(e){e&&e.target&&this.isEdgeBrowser()&&(e.which!==this.constants.keyCodes.down&&e.which!==this.constants.keyCodes.up||(this.chatHistoryNumberOfDays=_.parseInt(e.target.value),this.validateChatHistoryValue()))},e}();t.ChatPeoplePickerController=r,angular.module("teamspace.chatPeoplePicker",["pascalprecht.translate","teamspace.loggingService","teamspace.peopleService","teamspace.newChatService","teamspace.services.files.modules.p2p.p2pFilesStore","teamspace.services.actions.files.filesActionsFactory","teamspace.services.files.filesProviderFactory","teamspace.routeUtilityService","teamspace.platformDetectService"]).directive("chatPeoplePicker",function(){return{restrict:"E",scope:{},controllerAs:"cppCtrl",bindToController:{id:"@",existingChatRecipients:"=?",otherChatRecipient:"=?",focusOnInit:"=?",onBegin:"&",onProgress:"&",onError:"&",registerFocusCallback:"&",onFocusCallback:"&",onDisableComposeCallback:"&",ariaLabelledby:"@?",rlPpInputTitle:"@?",isChatScenario:"=?",peoplePickerFiltersForInitialSearch:"@?",peoplePickerFiltersForSubsequentSearch:"@?",ppAccRole:"@?",hideShareHistoryOptions:"=?",allSelectedRecipientsMris:"=",isAddToTenantEnabled:"<?",isExternalSearchEnabled:"<?"},template:s,controller:r}})},2056:function(e,t){e.exports='<div class="ts-chat-people-picker">\n  <div class="ts-add-members">\n    <div class="ts-select-people">\n      <recipient-line class="ts-teammates" recipients="cppCtrl.selectedRecipients" is-chat-scenario="true" message-context="cppCtrl.chatFilter" default-key-handler="cppCtrl.defaultKeyHandler(event)" picker-usage-area="{{::cppCtrl.constants.user.clientFeedback.scenarioName.newChatPicker}}" is-esc-disabled="cppCtrl.isEscDisabled" is-bot-search-enabled="cppCtrl.isBotSearchEnabled" on-add="cppCtrl.updateDialogState()" on-remove="cppCtrl.updateDialogState()" aria-labelledby="{{::cppCtrl.ariaLabelledby}}" pp-input-title="{{::cppCtrl.rlPpInputTitle}}" placeholder="{{cppCtrl.newPlaceholder}}" people-picker-filters-for-initial-search="{{cppCtrl.peoplePickerFiltersForInitialSearch}}" people-picker-filters-for-subsequent-search="{{cppCtrl.peoplePickerFiltersForSubsequentSearch}}" pp-acc-role="{{::cppCtrl.ppAccRole}}" is-add-to-tenant-enabled="::cppCtrl.isAddToTenantEnabled" is-external-search-enabled="cppCtrl.isExternalSearchEnabled">\n      </recipient-line>\n    </div>\n    <div class="ts-chat-people-picker-error" ng-show="cppCtrl.hasReachedMaxNumOfRecipients || cppCtrl.hasBotInGroupChat || (cppCtrl.chatHistoryOption === cppCtrl.chatHistoryOptionCustom && cppCtrl.isInvalidChatHistoryOption)">\n      <div ng-show="cppCtrl.hasReachedMaxNumOfRecipients && !cppCtrl.hasBotInGroupChat && !(cppCtrl.isInvalidChatHistoryOption)" aria-label="{{::cppCtrl.maxRosterSizeError}}">{{::cppCtrl.maxRosterSizeError}}</div>\n      <div translate-once="{{::$root.resources.strings.chat_botAddedToGroupChatError}}" aria-label="{{::$root.resources.strings.chat_botAddedToGroupChatError|translate}}" ng-show="cppCtrl.hasBotInGroupChat"></div>\n      <div translate-once="{{::$root.resources.strings.chat_invalidChatHistoryOptionSelectedError}}" aria-label="{{::cppCtrl.invalidChatHistoryOptionSelectedError}}" ng-show="cppCtrl.isInvalidChatHistoryOption"></div>\n    </div>\n\n    <div ng-if="cppCtrl.enableShareChatHistory" class="share-chat-history-container" acc-role="radio-group">\n      <div class="share-chat-history-item" ng-click="cppCtrl.setChatHistoryFocusAndValue(cppCtrl.chatHistoryOptionNo)">\n        <input class="share-chat-history-radio" type="radio" acc-role="radio" name="chatHistoryOption" id="chat-history-option-no" ng-model="cppCtrl.chatHistoryOption" ng-value="cppCtrl.chatHistoryOptionNo">\n        <ng-include class="unselected-icon icon" src="\'svg/icons-radiobox-unselected.html\'"></ng-include>\n        <ng-include class="selected-icon icon" src="\'svg/icons-radiobox-selected.html\'"></ng-include>\n        <label class="share-chat-history-name" for="chat-history-option-no">\n          {{::$root.resources.strings.chat_history_dont_include_chat_history|translate}}\n        </label>\n      </div>\n\n      <div class="share-chat-history-item" ng-click="cppCtrl.setChatHistoryFocusAndValue(cppCtrl.chatHistoryOptionCustom, $event)">\n        <input class="share-chat-history-radio" type="radio" acc-role="radio" name="chatHistoryOption" id="chat-history-option-custom" ng-model="cppCtrl.chatHistoryOption" ng-value="cppCtrl.chatHistoryOptionCustom" ng-focus="cppCtrl.setCustomOptionAriaInfo($event)">\n        <ng-include class="unselected-icon icon" src="\'svg/icons-radiobox-unselected.html\'"></ng-include>\n        <ng-include class="selected-icon icon" src="\'svg/icons-radiobox-selected.html\'"></ng-include>\n        <label class="share-chat-history-name" for="chat-history-option-custom">\n          {{::$root.resources.strings.chat_history_include_chat_history_from_x_days|translate}}\n          \x3c!--\n            This input element must be disabled if the custom option is not\n            picked so that you do not hit it when using Tab in keyboard mode\n          --\x3e\n          <input sanitized class="number-days" type="number" min="{{::cppCtrl.minSharedNumberDays}}" aria-valuemin="{{::cppCtrl.minSharedNumberDays}}" max="{{::cppCtrl.maxSharedNumberDays}}" aria-valuemax="{{::cppCtrl.maxSharedNumberDays}}" value="{{cppCtrl.chatHistoryNumberOfDays}}" aria-valuenow="{{cppCtrl.chatHistoryNumberOfDays}}" ng-model="cppCtrl.chatHistoryNumberOfDays" ng-click="cppCtrl.chatCustomDaysInputClicked($event)" ng-change="cppCtrl.validateChatHistoryValue()" ng-keyup="cppCtrl.keyupHandler($event)" ng-disabled="cppCtrl.chatHistoryOption !== cppCtrl.chatHistoryOptionCustom" aria-label="{{::cppCtrl.chatHistoryCustomInputNarration}}"/>\n        </label>\n      </div>\n\n      <div class="share-chat-history-item" ng-click="cppCtrl.setChatHistoryFocusAndValue(cppCtrl.chatHistoryOptionAll)">\n        <input class="share-chat-history-radio" type="radio" acc-role="radio" name="chatHistoryOption" id="chat-history-option-all" ng-model="cppCtrl.chatHistoryOption" ng-value="cppCtrl.chatHistoryOptionAll">\n        <ng-include class="unselected-icon icon" src="\'svg/icons-radiobox-unselected.html\'"></ng-include>\n        <ng-include class="selected-icon icon" src="\'svg/icons-radiobox-selected.html\'"></ng-include>\n        <label class="share-chat-history-name" for="chat-history-option-all">\n          {{::$root.resources.strings.chat_history_include_chat_history|translate}}\n        </label>\n      </div>\n    </div>\n\n    <div class="ts-chat-people-picker-banner app-notification-banner tab-notification-banner warning-error-banner" ng-class="{\'banner-show\': cppCtrl.disableCompose && cppCtrl.notifyChatDisabledMessage}">\n      {{cppCtrl.notifyChatDisabledMessage}}\n    </div>\n    <div>\n      <div ng-if="cppCtrl.existingChatRecipients.length > 0" class="ts-update-chat-line-separator ts-modal-dialog-footer-buttons-spacing">\n        <button class="ts-btn ts-btn-fluent ts-btn-fluent-secondary" ng-click="::cppCtrl.closeAddMembersDialog()" data-tid="addMembers-CancelButton" track-outcome="{{::$root.trackConstants.trackOutcome.select}}" track-scenario="{{::$root.trackConstants.trackScenario.addChatCancel}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.chatCreation}}" track-name="{{::$root.trackConstants.trackModuleName.addChatCancel}}" track-type="{{::$root.trackConstants.trackType.other}}" track-summary="Cancel add" translate-once="{{::$root.resources.strings.cancel}}"></button>\n        <button class="ts-btn ts-btn-fluent ts-btn-fluent-primary" ng-click="::cppCtrl.addMembersToChat()" data-tid="addMembers-AddButton" ng-disabled="cppCtrl.isAddButtonDisabled()" track-outcome="{{::$root.trackConstants.trackOutcome.submit}}" track-scenario="{{::$root.trackConstants.trackScenario.addChatConfirm}}" track-gesture="{{::$root.trackConstants.trackGesture.click}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.chatCreation}}" track-name="{{::$root.trackConstants.trackModuleName.addChatConfirm}}" track-type="{{::$root.trackConstants.trackType.other}}" track-summary="Add people confirm" track-data="{ \'Sharing\': \'{{cppCtrl.chatHistoryOption}}\' === \'{{cppCtrl.chatHistoryOptionCustom}}\' ? \'days-{{cppCtrl.chatHistoryNumberOfDays}}\' : \'{{cppCtrl.chatHistoryOption}}\' }" translate-once="{{::$root.resources.strings.chats_addRecipientsButton}}"></button>\n      </div>\n    </div>\n  </div>\n</div>'}},[2054]);
//# sourceMappingURL=https://statics.teams.cdn.office.net/hashedjs/lazy-ng1-mod-chat-people-picker-components.min.js-7984ab2f.map