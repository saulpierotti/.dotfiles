webpackJsonp([24],{1832:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(1833)},1833:function(e,t,i){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=teamspace.services,r=i(1834),d=i(218),s=function(){function e(e,t,i,n,o,r,d){var s=this;this.constants=e,this.storageService=t,this.loggingService=i,this.$window=n,this.settingsService=o,this.shellService=r,this.$injector=d,this.enabled=!0,this.loaded=!0,this.logger=i.newLogger("MW::MultiWindowServiceLazy"),n.desktopSettings&&n.desktopSettings.enableMultiWindowForceClose||n.addEventListener("beforeunload",function(){return s.closeAllWindows()})}return e.$inject=["constants","storageService","loggingService","$window","settingsService","shellService","$injector"],Object.defineProperty(e.prototype,"numChildWindows",{get:function(){return this.windowManager?this.windowManager.numChildWindows:0},enumerable:!0,configurable:!0}),e.prototype.openWindow=function(e,t){if(!e||!e.isValid())return this.logger.error("Attempted to create new child window but invalid parameters were given."),Promise.resolve(void 0);var i,r=e.createWindowDefinition();return this.logger.info("Opening new window of type="+r.type+" with id="+r.windowId+", contentId="+(r.content&&r.content.id)+"."),r&&(i=n({},r,{isFocused:!1,state:o.WindowState.Initializing}),this.windowManager.launchNewWindow(i,t),this.notifyListeners(i)),Promise.resolve(i)},e.prototype.findWindow=function(e){var t=this.windowManager.findWindow(e);return t?this.logger.debug("findWindow found window "+t.windowId):this.logger.debug("findWindow did not find window matching params: "+(e?JSON.stringify(e):"")),t},e.prototype.broadcastToAllWindows=function(e){e&&e.eventId&&this.windowManager.executeOnEachWindow(function(t){t.windowRef.postMessage(e)})},e.prototype.requestToAllWindows=function(e,t){var i=this;return new Promise(function(n,r){if(e&&e.eventId){var d=[];i.windowManager.executeOnEachWindow(function(i){i.state!==o.WindowState.Crashed&&i.state!==o.WindowState.Closed&&d.push(i.windowRef.requestMessage(e,t).then(function(e){return{event:e,childWindow:i}}))}),i.$window.setTimeout(function(){r("Request timed out to child windows.")},2*t),Promise.all(d).then(function(e){n(e)}).catch(function(e){var t="Unknown error occurred during requestToAllWindows: error="+e+".";i.logger.error(t),r(t)})}else r("Invalid parameters given.")})},e.prototype.closeAllWindows=function(e){var t=this;void 0===e&&(e=!0);return this.logger.info("Starting to close all child windows and will persist: "+e+"."),new Promise(function(i){if(0!==t.windowManager.numChildWindows){var n=t.$window.setInterval(function(){var e=!t.windowManager,o=e||0===t.windowManager.numChildWindows;(e||o)&&(t.$window.clearInterval(n),e&&t.logger.warn("Could not confirm all child windows were closed before resources freed."),o&&t.logger.info("All windows confirmed closed."),i())},100);t.$window.setTimeout(function(){i()},5e3),e&&(t.windowManager.persistOpenWindowsToStorage(!0),t.windowManager.persistDuringTearingDown=!0),t.windowManager.executeOnEachWindow(function(e){e.windowRef.close()}),t.windowManager.persistDuringTearingDown=!1}else i()})},e.prototype.subscribeForNewWindowEvents=function(e,t){t&&(this.registeredNewWindowListeners.push(t),this.logger.info("New subscriber for new window events registers by "+e+", totalListeners="+this.registeredNewWindowListeners.length+"."))},e.prototype.initializeLazyService=function(){var e=this;this.additionalEntryPointsEnabled=this.settingsService.valueAsBoolean(this.constants.settings.names.enableMultiWindowAdditionalEntryPoints),this.serviceWrapper=new d.AngularServiceWrapper(this.constants,this.$injector,this.$window),this.windowManager=new r.WindowManager(this.$window,this.constants,this.storageService,this.logger,this.shellService,this.serviceWrapper),o.WindowParams.settingsService=this.settingsService,o.WindowParams.constants=this.constants,o.WindowParams.generateUuid=function(){return e.serviceWrapper.generateUuid()};try{this.serviceWrapper.initialize(),this.windowManager.reloadPersistedWindows(function(t){return e.notifyListeners(t)})}catch(e){this.logger.error("Error hit recovering persisted windows: "+e)}},e.prototype.teardown=function(){var e=this;return this.logger.info("Commencing teardown."),this.closeAllWindows(!0).then(function(){e.additionalEntryPointsEnabled=!1,e.listenerBuffer=void 0,e.windowManager=void 0,e.serviceWrapper=void 0})},e.prototype.notifyListeners=function(e){if(e.windowRef)for(var t=0;t<this.registeredNewWindowListeners.length;t++)this.registeredNewWindowListeners[t](e)},Object.defineProperty(e.prototype,"registeredNewWindowListeners",{get:function(){return this.listenerBuffer||(this.listenerBuffer=[]),this.listenerBuffer},enumerable:!0,configurable:!0}),e}();t.MultiWindowServiceLazy=s,angular.module("teamspace.multiWindowServiceLazy",["teamspace.shellService","teamspace.constants"]).service("multiWindowServiceLazy",s)},1834:function(e,t,i){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=teamspace.services,r=i(1835),d=function(){function e(e,t,i,n,o,d){this.window=e,this.constants=t,this.storageService=i,this.logger=n,this.persistDuringTearingDown=!1,this.childrenWindows={},this.windowCount=0,this.windowProvider=new r.ElectronWindowProvider(e,t,this,d,n.service,o);this.debouncedPersistOpenWindowsToStorage=_.debounce(this.persistanceToStorageHelper.bind(this),1e3)}return Object.defineProperty(e.prototype,"numChildWindows",{get:function(){return this.windowCount},enumerable:!0,configurable:!0}),e.prototype.launchNewWindow=function(e,t,i){void 0===i&&(i=!1);var n=this.findWindow({contentId:e.content.id});n?i||n.windowRef.focus():(this.logger.info("Launching new window: id="+e.windowId+", type="+e.type+", entryPoint="+t+"."),this.windowProvider.createWindow(e,t),e.windowRef?(e.contentToRender&&e.windowRef.setBody(e.contentToRender),this.addWindow(e),i||this.persistOpenWindowsToStorage()):this.logger.error("ERROR: We expected a window handle to be created but there was a failure!"))},e.prototype.removeWindow=function(e,t){void 0===t&&(t=!this.persistDuringTearingDown),e&&this.childrenWindows[e.windowId]?(this.logger.info("Removing child window: id="+e.windowId+"."),this.logger.service.event(this.constants.events.multiWindow.close,{windowId:e.windowId}),delete this.childrenWindows[e.windowId],this.windowCount--,t&&this.persistOpenWindowsToStorage()):this.logger.warn("Tried to close window that isn't tracked "+(e?e.windowId:"undefined")+".")},e.prototype.getWindow=function(e){var t;return e&&(t=this.childrenWindows[e]),t},e.prototype.getValidWindow=function(e){if(e&&this.childrenWindows[e]){var t=this.childrenWindows[e];if(t.windowRef&&t.windowRef.isValid())return t;this.removeWindow(t)}},e.prototype.updateWindow=function(e,t){if(e&&t){if(this.logger.info("Child window updated, id="+t.newId+", type="+t.newType+"."),t.newId){var i=this.findWindow({contentId:t.newId});i&&i.windowId!==e.windowId&&i.windowRef.close(),e.content.id=t.newId,this.persistOpenWindowsToStorage()}t.newType&&(e.type=o.WindowParams.convertExperienceIdToString(t.newType))}},e.prototype.findWindow=function(e){var t;return e&&(e.windowId&&(t=this.getValidWindow(e.windowId)),!t&&e&&(t=this.searchWindowContent(e))),t},e.prototype.executeOnEachWindow=function(e){for(var t in this.childrenWindows){var i=this.getValidWindow(t);i&&e(i)}},e.prototype.persistOpenWindowsToStorage=function(e){void 0===e&&(e=!1),this.logger.info("Persisting current windows: immediate="+e+", windowCount="+this.numChildWindows+"."),e?this.persistanceToStorageHelper():this.debouncedPersistOpenWindowsToStorage()},e.prototype.reloadPersistedWindows=function(e){var t=this,i=this.loadOpenedWindowsFromStorage();if(i){var n=function(o){o?t.window.setTimeout(function(){o.timeOpened=Date.now(),t.launchNewWindow(o,t.constants.events.multiWindow.entryPoints.reloadPersistedWindows,!0),n(i.pop()),e&&e(o)},1e3):t.logger.info("Detected "+t.numChildWindows+" child windows from prior session and restored.")};n(i.pop())}},e.prototype.loadOpenedWindowsFromStorage=function(){var e,t=this.storageService.get(this.constants.multiWindow.storageKeys.multiWindowStorage);return t&&(e=[],_.forEach(t,function(t){e.push(n({},t,o.WindowParams.generateWindowArgs(t.type,t.content).createWindowDefinition(),{isFocused:!1,state:o.WindowState.Initializing}))})),e},e.prototype.addWindow=function(e){e&&e.windowId&&e.windowRef&&(this.logger.info("Adding child window: id="+e.windowId+"."),this.childrenWindows[e.windowId]=e,this.windowCount++)},e.prototype.persistanceToStorageHelper=function(){if(this.childrenWindows&&this.windowCount>0){var e=[];for(var t in this.childrenWindows){var i=this.childrenWindows[t];i&&i.shouldPersist&&e.push({type:i.type,timeOpened:i.timeOpened,width:i.width,height:i.height,left:i.left,top:i.top,content:i.content})}this.storageService.set(this.constants.multiWindow.storageKeys.multiWindowStorage,e)}else this.storageService.set(this.constants.multiWindow.storageKeys.multiWindowStorage,void 0)},e.prototype.searchWindowContent=function(e){if(e.hasFocus)return this.matchesCriteria(this.windowProvider.focusedChildWindow,e)?this.getValidWindow(this.windowProvider.focusedChildWindow.windowId):void 0;for(var t in this.childrenWindows){var i=this.childrenWindows[t];if(this.matchesCriteria(i,e)){var n=this.getValidWindow(t);if(n)return n}}},e.prototype.matchesCriteria=function(e,t){var i;return e&&(e.content&&t.contentId&&(i=!1!==i&&e.content.id===t.contentId),t.hasFocus&&(i=!1!==i&&e.isFocused===t.hasFocus),void 0!==t.windowState&&(i=!1!==i&&e.state===t.windowState)),!!i},e}();t.WindowManager=d},1835:function(e,t,i){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=teamspace.services,r=i(1836),d=i(1837),s=i(1838),a=function(){function e(t,i,n,o,r,d){this.mainRenderer=t,this.constants=i,this.windowManager=n,this.serviceWrapper=o,this.loggingService=r,this.childWindowOffsetX=e.INITIAL_NEW_WINDOW_OFFSET,this.childWindowOffsetY=e.INITIAL_NEW_WINDOW_OFFSET,this.logger=r.newLogger("MW::ElectronWindowProvider"),this.enableChildWindowResizing=t.desktopSettings.enableChildWindowResizing,d?this.comms=new s.ShellWindowCommunicator(d,n,o,r):this.logger.error("Tried to create the Window Communication Provider but no communication provider was present!")}return e.prototype.createWindow=function(t,i){this.serviceWrapper.sendBiTelemetry(i,t.type);var n=this.mainRenderer.innerWidth,o=this.mainRenderer.innerHeight,s=this.serviceWrapper.getHostSettings(t);if(!t.initialBackgroundColor){var a=s&&s.hostSettings&&s.hostSettings.theme;this.setWindowDefBackgroundTheme(t,a)}var w={loadUrl:encodeURIComponent(t.url),usingCustomContent:!!t.contentToRender,windowId:t.windowId,windowType:t.type,controlledWindowShow:t.controlledWindowShow,hostSettings:s,perfMarkers:{windowCreateTimeFromMainRenderer:Date.now()}},c="teamsmw://"+this.constants.multiWindow.windowManager.launchWindowManager+","+JSON.stringify(w),l=this.getOpenWindowParameters(t);this.childWindowOffsetX+=e.NEW_WINDOW_OFFSET,this.childWindowOffsetX+this.constants.multiWindow.childWindow.width>n&&(this.childWindowOffsetX=e.INITIAL_NEW_WINDOW_OFFSET),this.childWindowOffsetY+=e.NEW_WINDOW_OFFSET,this.childWindowOffsetY+this.constants.multiWindow.childWindow.height>o&&(this.childWindowOffsetY=e.INITIAL_NEW_WINDOW_OFFSET);var h;try{(h=this.mainRenderer.open(c,"*",l))?(h.open?t.windowRef=new d.ElectronNativeWindowHandle(h,this.comms,t.windowId,this.constants,this.loggingService):t.windowRef=new r.ElectronChildWindowHandle(h,this.comms,t.windowId,this.constants,this.loggingService),this.registerForBaseEvents(t.windowRef),this.registerForTeardown(t)):this.logger.error("Error creating window: window.open returned undefined!")}catch(e){this.logger.error("Error creating window: "+e),h&&h.close()}},e.prototype.getOpenWindowParameters=function(t){var i,n=this.enableChildWindowResizing&&t.type===o.MultiWindowBaseTypes.Call,r=n?this.constants.multiWindow.childWindow.calling.minWidth:this.constants.multiWindow.childWindow.minWidth,d=n?this.constants.multiWindow.childWindow.calling.minHeight:this.constants.multiWindow.childWindow.minHeight;if(n)i=this.callingWindowSizeFromParentWidth(this.mainRenderer.innerWidth||1),t.width=i[0],t.height=i[1];else{if(t.width&&"number"==typeof t.width&&t.width>=r||(t.width=(this.mainRenderer.innerWidth||1)*e.CHILD_PARENT_WIDTH_RATIO,t.width<this.constants.multiWindow.childWindow.width&&(t.width=this.constants.multiWindow.childWindow.width)),t.width=this.adjustWidthForScreen(t.width),!(t.height&&"number"==typeof t.height&&t.height>=d)){var s=this.mainRenderer.innerHeight||1,a=t.width*e.CHILD_WIDTH_HEIGHT_RATIO,w=s*e.CHILD_HEIGHT_RATIO;t.height=Math.min(a,w);var c=t.height/e.CHILD_WIDTH_HEIGHT_RATIO;t.width>c&&(t.width=c),t.height<this.constants.multiWindow.childWindow.height&&(t.height=this.constants.multiWindow.childWindow.height),t.width<this.constants.multiWindow.childWindow.width&&(t.width=this.constants.multiWindow.childWindow.width)}t.height=this.adjustHeightForScreen(t.height)}return t.left=!isNaN(t.left)&&"number"==typeof t.left&&t.left>=0&&t.left+t.width/2<=this.mainRenderer.screen.availWidth?t.left:Math.max(this.mainRenderer.screenX,0)+this.childWindowOffsetX,t.top=!isNaN(t.top)&&"number"==typeof t.top&&t.top>=0&&t.top>=0&&t.top+t.height/2<=this.mainRenderer.screen.availHeight?t.top:Math.max(this.mainRenderer.screenY,0)+this.childWindowOffsetY,"width="+t.width+",height="+t.height+",minHeight="+d+",minWidth="+r+",left="+t.left+",top="+t.top+",backgroundColor="+t.initialBackgroundColor+",frame="+(t.frame?"yes":"no")+",autoHideMenuBar=yes,toolbar=no,location=yes,status=no,menubar=no,scrollbars=no"},e.prototype.adjustWidthForScreen=function(t){var i=this.mainRenderer.screen.availWidth-e.INITIAL_NEW_WINDOW_OFFSET;return t>i?i:t},e.prototype.adjustHeightForScreen=function(t){var i=this.mainRenderer.screen.availHeight-e.INITIAL_NEW_WINDOW_OFFSET;return t>i?i:t},e.prototype.callingWindowWidthFromParentWidth=function(e){var t=this.constants.multiWindow.childWindow.calling.childParentWidthRatio,i=(e||1)*t;return this.adjustWidthForScreen(i)},e.prototype.callingWindowHeightFromWidth=function(e){var t=e*this.constants.multiWindow.childWindow.calling.widthHeightRatio;return this.adjustHeightForScreen(t)},e.prototype.callingWindowSizeFromParentWidth=function(e){var t=this.constants.multiWindow.childWindow.calling.minWidth,i=this.constants.multiWindow.childWindow.calling.minHeight,n=this.callingWindowWidthFromParentWidth(e),o=this.callingWindowHeightFromWidth(n);return o<i&&(o=i),n<t&&(n=t),[n,o]},e.prototype.getTelemetryPayload=function(e){return{elapsedTimeOpened:(new Date).getTime()-e.timeOpened,windowId:e.windowId,contentId:e.content?e.content.id:"unknown",success:!!e.windowRef,environment:"electron",type:e.type,newRenderer:!!e.contentToRender,windowsOpened:this.windowManager.numChildWindows}},e.prototype.registerForBaseEvents=function(e){var t=this;e&&(e.addEventListener(o.ChildWindowEventRequest.Focus,function(e,i){i.isFocused=!0,t.focusedChildWindow=i}),e.addEventListener(o.ChildWindowEventRequest.Blur,function(e,i){i.isFocused=!1,t.focusedChildWindow=void 0,e.payload&&(i.width=e.payload.width,i.height=e.payload.height,i.left=e.payload.left,i.top=e.payload.top,t.windowManager.persistOpenWindowsToStorage())}),e.addEventListener(o.ChildWindowEventRequest.WindowReady,function(e,i){t.logger.info("Child window has reported ready state: windowId:"+i.windowId+"."),i.state=o.WindowState.Active}),e.addEventListener(o.ChildWindowEventRequest.WindowInitialized,function(e,i){t.logger.info("Child window has reported it is fully initialized: windowId:"+i.windowId+".")}),e.addEventListener(o.ChildWindowEventRequest.WindowCrashed,function(e,i){var r=e.payload||{},d=e.payload&&e.payload.errorMsg;if(r.showOops){var s=r.logs&&Array.isArray(r.logs)&&r.logs.length>0,a=s?"\nLogs emitted for the child window crash:\n":"";t.logger.warn("Child window has hit an unrecovered errored state: windowId="+i.windowId+", type="+i.type+", errorMsg="+d+", errorCode="+r.errorCode+"."+a),r.errorStack&&t.logger.warn("Error Stack: "+r.errorStack),s&&r.logs.forEach(function(e){t.logger.warn(e.timeStamp+" "+e.levelName+" - "+e.message)})}i.state=o.WindowState.Crashed;var w=n({},t.getTelemetryPayload(i),{hadFocus:!!i.isFocused,killed:!!r.killed,errorMsg:d,errorCode:r.errorCode,errorDescription:r.errorDescription,errorContext:r.errorContext,errorSubContext:r.errorSubContext,errorStack:r.errorStack,showOops:!!r.showOops,experienceClientVersion:r.clientVersion,experienceType:o.WindowParams.convertExperienceIdToString(r.experienceId)});i.url&&!i.url.includes("local.teams.office.com")&&t.logger.service.newScenario(t.constants.multiWindow.scenario.crashedWindow).stop(w)}),e.addEventListener(o.ChildWindowEventRequest.WillNavigate,function(e,i){t.logger.info("Child window tried to navigate to a new page (blocked): windowId:"+i.windowId+"!")}),e.addEventListener(o.ChildWindowEventRequest.DidNavigationInPage,function(e,i){var n=e.payload&&e.payload.url;n?t.logger.info("Child window navigated inplace: windowId:"+i.windowId+", url:"+n+"."):t.logger.error("We received a request to change inplace navigation but no url was provided.")}),e.addEventListener(o.ChildWindowEventRequest.NewWindow,function(e,i){t.logger.info("Child window requested to open new window directly (blocked): windowId:"+i.windowId+", url:"+(e.payload&&e.payload.url)+".")}),e.addEventListener(o.ChildWindowEventRequest.AadGetToken,function(e,i){var n=o.ChildWindowEventRequest.AadGetToken,r={eventId:n,correlationId:e.correlationId};if(e.correlationId&&e.payload){var d=e.payload.resource;t.logger.info("Child window requested AAD token: windowId="+i.windowId+", resource="+d+", correlationId="+e.correlationId),t.serviceWrapper.getAadToken(d).then(function(e){r.payload={token:e},i.windowRef.postMessage(r)}).catch(function(n){t.logger.error("ERROR: failed to get auth token: windowId="+i.windowId+", correlationId="+e.correlationId+", error="+n),r.error={context:"AadGetToken",message:n},i.windowRef.postMessage(r)})}else{var s="Expected payload or correlationId for "+n+" but got none.";t.logger.error(s),r.error={context:"AadGetToken",message:s},i.windowRef.postMessage(r)}}),e.addEventListener(o.ChildWindowEventRequest.AadGetCurrentUser,function(e,i){var n={eventId:o.ChildWindowEventRequest.AadGetCurrentUser,correlationId:e.correlationId};if(e.correlationId)t.logger.info("Child window requested current logged in user: windowId="+i.windowId+", correlationId="+e.correlationId),t.serviceWrapper.getAuthUser().then(function(e){n.payload={authUser:e},i.windowRef.postMessage(n)}).catch(function(o){t.logger.error("ERROR: failed to get current logged in user: windowId="+i.windowId+", correlationId="+e.correlationId+", error="+o),n.error={context:"AadGetCurrentUser",message:o},i.windowRef.postMessage(n)});else{var r="ERROR: AadGetCurrentUser request was made but no correlationId was given.";t.logger.error(r),n.error={context:"AadGetCurrentUser",message:r},i.windowRef.postMessage(n)}}),e.addEventListener(o.ChildWindowEventRequest.AadClearCache,function(e,i){if(e.payload){var n=e.payload.resource;t.logger.debug("Child window requested clear adal cache: windowId="+i.windowId+", resource="+n+", correlationId="+e.correlationId),t.serviceWrapper.clearAadCache(n)}else{var r=o.ChildWindowEventRequest.AadClearCache;t.logger.error("Expected data for "+r+" but got none.")}}),e.addEventListener(o.ChildWindowEventRequest.UpdateWindowState,function(e,i){if(e.payload&&e.payload.childSettings){var n=e.payload.childSettings;if(t.windowManager.updateWindow(i,n),n.appState){var r=n.appState,d=i.state;r!==o.ApplicationState.Inactive&&r!==o.ApplicationState.LongInactive||d!==o.WindowState.Active?r===o.ApplicationState.Interactive&&(i.state=o.WindowState.Active,t.serviceWrapper.emitMessage("IdleEnd")):i.state=o.WindowState.Idle}if(t.enableChildWindowResizing&&n.newType){var s=o.WindowParams.convertExperienceIdToString(n.newType)===o.MultiWindowBaseTypes.Call,a=s?t.constants.multiWindow.childWindow.calling.minWidth:t.constants.multiWindow.childWindow.minWidth,w=s?t.constants.multiWindow.childWindow.calling.minHeight:t.constants.multiWindow.childWindow.minHeight;t.logger.info("Child window "+i.windowId+" requesting to update its minimum size to: width:"+a+", height:"+w+".");var c={eventId:o.ChildWindowEventSendOnly.MinimumSizeUpdate,correlationId:e.correlationId,payload:{minWidth:a,minHeight:w}};if(i.windowRef.postMessage(c),s){t.logger.info("Child window "+i.windowId+" requesting to update its size using: minWidth:"+a+", minHeight:"+w+".");var l={eventId:o.ChildWindowEventSendOnly.ResizeWindow,correlationId:e.correlationId,payload:{minWidth:a,minHeight:w}};i.windowRef.postMessage(l)}}}else{var h=o.ChildWindowEventRequest.UpdateWindowState;t.logger.error("Expected data for "+h+" but got none.")}}),e.addEventListener(o.ChildWindowEventRequest.RequestShellToOpen,function(e,i){if(e.payload){var n=e.payload.openType,r=e.payload.openHandler,d=e.payload.handlerParams;if(void 0!==n&&void 0!==r){var s=!1;switch(t.logger.info("Child window "+i.windowId+" requesting to open new window: openType:"+n+", openHandler:"+r+"."),n){case o.OpenType.OpenInNewChildWindowFallBackToMain:(s=t.serviceWrapper.openWindow(r,d))||(s=t.serviceWrapper.navigateMainWindow(r,d));break;case o.OpenType.OpenInNewChildWindow:s=t.serviceWrapper.openWindow(r,d);break;case o.OpenType.OpenOnMainRenderer:s=t.serviceWrapper.navigateMainWindow(r,d)}s||t.logger.warn("No handlers found for "+r+" for openType="+n)}else t.logger.error("Expected data for "+event+" but got none.")}else{var a=o.ChildWindowEventRequest.RequestShellToOpen;t.logger.error("Expected data for "+a+" but got none.")}}),e.addEventListener(o.ChildWindowEventRequest.GetStateData,function(e,i){var n={eventId:o.ChildWindowEventRequest.GetStateData,correlationId:e.correlationId},r=Promise.resolve();switch(t.logger.info("Child window requested state data: windowId="+i.windowId+", correlationId="+e.correlationId+", requestType="+e.payload.requestType),e.payload.requestType){case"hostSettings":n.payload={hostSettings:t.serviceWrapper.getHostSettings(i)};break;case"skypeToken":r=t.serviceWrapper.getSkypeToken().then(function(e){n.payload={skypeTokenData:e}});break;default:n.error={context:"GetStateData",message:"requestType not supported"}}r.then(function(){i.windowRef.postMessage(n)}).catch(function(o){t.logger.error("GetStateData: Received error trying to process request: "+e.payload.requestType+", error="+(o.message?o.message:o)+"."),n.error={context:"GetStateData",message:o},i.windowRef.postMessage(n)})}))},e.prototype.registerForTeardown=function(e){var t=this;this.comms.registerForTeardown(e.windowId,function(){if(e){t.windowManager.removeWindow(e),e.state=o.WindowState.Closed,t.windowManager.numChildWindows<=0&&(t.logger.info("Focusing out from main window"),t.serviceWrapper.emitMessage(t.constants.events.desktopApp.windowIsFocused,!0));var i={elapsedTimeOpened:(new Date).getTime()-e.timeOpened,type:e.type,windowsOpened:t.windowManager.numChildWindows};t.logger.service.newScenario(t.constants.multiWindow.scenario.closedWindow).stop(i),t.mainRenderer.localStorage.removeItem("persistedDiagnostics-"+e.windowId)}})},e.prototype.setWindowDefBackgroundTheme=function(e,t){var i;switch(t){case"dark":i=this.constants.files.themes.darkPalette.neutralLight;break;case"contrast":i=this.constants.files.themes.contrastPalette.appBlackFull;break;default:i=this.constants.files.themes.default.neutralLighter}e.initialBackgroundColor=i},e.INITIAL_NEW_WINDOW_OFFSET=100,e.NEW_WINDOW_OFFSET=20,e.CHILD_WIDTH_HEIGHT_RATIO=1.125,e.CHILD_HEIGHT_RATIO=.72,e.CHILD_PARENT_WIDTH_RATIO=.4,e}();t.ElectronWindowProvider=a},1836:function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=teamspace.services,d=function(e){function t(t,i,n,o,r){var d=e.call(this,n,o)||this;return d.electronProxy=t,d.comms=i,d.logger=r.newLogger("MW::ElectronChildWindowHandle"),d}return n(t,e),t.prototype.blur=function(){var e=r.ChildWindowEventSendOnly.BlurChildWindow;this.recordAction(e),this.postMessage({eventId:e},void 0)},t.prototype.close=function(){this.recordAction(r.ChildWindowEventRequest.Closed),this.electronProxy&&!this.electronProxy.closed&&(this.electronProxy.close(),this.postMessage({eventId:r.ChildWindowEventSendOnly.CloseChildWindow},void 0))},t.prototype.focus=function(){var e=r.ChildWindowEventSendOnly.FocusChildWindow;this.recordAction(e,!0),this.postMessage({eventId:e},void 0)},t.prototype.flashTaskbarIcon=function(){var e=r.ChildWindowEventSendOnly.FlashChildWindowTaskbarIcon;this.recordAction(e,!0),this.postMessage({eventId:e},void 0)},t.prototype.unflashTaskbarIcon=function(){var e=r.ChildWindowEventSendOnly.UnflashChildWindowTaskbarIcon;this.recordAction(e,!0),this.postMessage({eventId:e},void 0)},t.prototype.postMessage=function(e,t){void 0===t&&(t=this.windowId);var i=o({windowId:t},e);this.comms.sendEvent(i)},t.prototype.requestMessage=function(e,t){void 0===t&&(t=this.defaultRequestTimeoutMs);var i=o({windowId:this.windowId},e);return this.comms.request(i,t)},t.prototype.setBody=function(e){},t.prototype.isValid=function(){return this.electronProxy&&!this.electronProxy.closed},t.prototype.addEventListener=function(e,t,i){var n=i&&i.once;this.comms.registerListener(this.windowId,e,t,n)},t.prototype.removeEventListener=function(e,t){this.comms.removeListener(this.windowId,e,t)},t}(i(217).BaseWindowHandle);t.ElectronChildWindowHandle=d},1837:function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=teamspace.services,d=function(e){function t(t,i,n,o,r){var d=e.call(this,n,o)||this;return d.windowRef=t,d.comms=i,d.logger=r.newLogger("MW::ElectronNativeWindowHandle"),d}return n(t,e),t.prototype.blur=function(){var e=r.ChildWindowEventSendOnly.BlurChildWindow;this.recordAction(e),this.postMessage({eventId:e},void 0)},t.prototype.close=function(){this.recordAction(r.ChildWindowEventRequest.Closed),this.windowRef.close(),this.postMessage({eventId:r.ChildWindowEventSendOnly.CloseChildWindow},void 0)},t.prototype.focus=function(){var e=r.ChildWindowEventSendOnly.FocusChildWindow;this.recordAction(e,!0),this.postMessage({eventId:e},void 0)},t.prototype.flashTaskbarIcon=function(){var e=r.ChildWindowEventSendOnly.FlashChildWindowTaskbarIcon;this.recordAction(e,!0),this.postMessage({eventId:e},void 0)},t.prototype.unflashTaskbarIcon=function(){var e=r.ChildWindowEventSendOnly.UnflashChildWindowTaskbarIcon;this.recordAction(e,!0),this.postMessage({eventId:e},void 0)},t.prototype.postMessage=function(e,t){void 0===t&&(t=this.windowId);var i=o({windowId:t},e);this.comms.sendEvent(i)},t.prototype.requestMessage=function(e,t,i){void 0===t&&(t=this.defaultRequestTimeoutMs),void 0===i&&(i=this.windowId);var n=o({windowId:i},e);return this.comms.request(n,t)},t.prototype.setBody=function(e){var t=this,i=function(){t.windowRef.document.body.appendChild(e)};"complete"!==this.windowRef.document.readyState?this.windowRef.document.addEventListener("DOMContentLoaded",function(){i()},{once:!0}):i()},t.prototype.isValid=function(){return!!this.windowRef},t.prototype.addEventListener=function(e,t,i){var n=i&&i.once;this.comms.registerListener(this.windowId,e,t,n)},t.prototype.removeEventListener=function(e,t){this.comms.removeListener(this.windowId,e,t)},t}(i(217).BaseWindowHandle);t.ElectronNativeWindowHandle=d},1838:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=teamspace.services,o=function(){function e(e,t,i,n){this.shellService=e,this.windowManager=t,this.serviceWrapper=i,this.logger=n.newLogger("MW::ShellWindowComms"),this.commsProvider=e.getCommunicationProvider(),this.subscriptionManager=e.RxJS.createSubject(),this.tearDownManager=e.RxJS.createSubject(),this.closeEventObservableCache=new Map}return e.prototype.sendEvent=function(e){this.commsProvider.getStream(e.eventId).next(e,e.windowId,this.shellService.MAIN_PROCESS_ID)},e.prototype.request=function(e,t){var i=this;return new Promise(function(n,o){var r,d=function(t){clearTimeout(r),t||i.logger.warn("Window request to child window failed to get event data back: event="+e.eventId+", windowId="+e.windowId+"."),n(t)};r=setTimeout(function(){i.removeListener(e.windowId,e.eventId,d),i.logger.warn("Window request to child window timeout: event="+e.eventId+", windowId="+e.windowId+"."),n(void 0)},t),i.registerListener(e.windowId,e.eventId,d,!0,e.correlationId),i.sendEvent(e)})},e.prototype.registerListener=function(e,t,i,o,r){var d=this;if(void 0===o&&(o=!1),e&&t&&i){var s=this.shellService.RxJS;this.logger.debug("Event subscribed: windowId="+e+", event="+t+".");var a=this.createStreamOnWindow(e,t),w=this.subscriptionManager.pipe(s.filter(function(n){return!(n.windowId!==e||void 0!==n.event&&n.event!==t||void 0!==n.correlationId&&n.correlationId!==r||void 0!==n.listener&&n.listener!==i)}),s.tap(function(){d.logger.debug("Event unsubscribed: windowId="+e+", event="+t+".")}));(o||t===n.ChildWindowEventRequest.Closed?a.pipe(s.first(),s.takeUntil(w)):a.pipe(s.takeUntil(w))).subscribe(function(t){var n=d.windowManager.getWindow(e);i(t,n)},function(e){d.logger.error("Subscribe encountered error: "+(e.message?e.message:e))})}},e.prototype.removeListener=function(e,t,i,n){this.subscriptionManager.next({windowId:e,event:t,listener:i,correlationId:n})},e.prototype.registerForTeardown=function(e,t){var i=this,n=this.shellService.RxJS;this.tearDownManager.asObservable().pipe(n.filter(function(t){return t===e}),n.first()).subscribe(function(){i.logger.info("Tearing down window: "+e),t(),i.subscriptionManager.next({windowId:e})})},e.prototype.createStreamOnWindow=function(e,t){var i,o=this,r=this.shellService.RxJS;if(t===n.ChildWindowEventRequest.Closed)this.closeEventObservableCache.has(e)?i=this.closeEventObservableCache.get(e):(i=(d=this.commsProvider.getStream(t).asObservable()).pipe(r.filter(function(t){return t.windowId===e}),r.finalize(function(){o.tearDownManager.next(e)}),r.share()),this.closeEventObservableCache.set(e,i));else{var d=this.commsProvider.getStream(t).asObservable();i=d.pipe(r.filter(function(t){return t.windowId===e}))}return i},e}();t.ShellWindowCommunicator=o},217:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.windowId=e,this.constants=t,this.defaultRequestTimeoutMs=2e3}return e.prototype.recordAction=function(e,t){if(void 0===t&&(t=!1),this.logger.info("Window action performed; action="+e+" id="+this.windowId+"."),event){var i={windowId:this.windowId,action:e};this.logger.service.event(this.constants.events.multiWindow.action,i)}},e}();t.BaseWindowHandle=n}},[1832]);
//# sourceMappingURL=https://statics.teams.cdn.office.net/hashedjs/lazy-ng1-mod-multi-window-services.min.js-22d4f91e.map